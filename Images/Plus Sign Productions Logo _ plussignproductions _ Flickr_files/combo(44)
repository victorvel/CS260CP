YUI.add("gallery-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-galleries-getPhotos"].run(t,this.appContext)},create:function(t,r){return e.ModelCreators["flickr-galleries-create"].run(t,r)},addPhoto:function(t,r){return e.ModelCreators["flickr-galleries-addPhoto"].run(t,r)},removePhoto:function(t,r){return e.ModelDeletors["flickr-galleries-removePhoto"].run(t,r)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},getPrimaryUrlToFit:function(t,r){this.getValue(t,"primaryPhotoSizes");var i=e.PhotoModelHelper.getSizeToFit(t,{height:r?r.width:75,width:r?r.height:75},e.merge({sizes:this.getValue(t,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0}));return i?i.src:""},attributes:{compoundId:{validator:function(t,r){return e.Lang.isString(t)&&t.indexOf("-")>-1}},displayType:{readOnly:!0,defaultFn:function(){return"gallery"}},title:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){var r=e.AttributeHelpers.coerceString(t);return r=r.replace(/\\'/,"'").replace(/\\"/,'"').replace(/\\\\/,"\\")},defaultValue:""},description:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},photoPageList:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-galleries-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-galleries-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(t,r){return e.AttributeHelpers.validateInteger(t)},setter:function(t,r){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},itemCount:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){return this.getValue(e,"photoCount")+this.getValue(e,"videoCount")}},photoCountDisplay:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),r=this.getValue(e,"videoCount"),i="";return 0===t&&0===r?i=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1===t&&0===r?i=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&0===r?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):0===t&&1===r?i=this.intlMessage({intlName:"models.ONE_VIDEO"}):1===t&&1===r?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&1===r?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):0===t&&r>1?i=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:r}):1===t&&r>1?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:r}):t>1&&r>1&&(i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:r})),i}},viewCount:{validator:function(t,r){return e.AttributeHelpers.validateInteger(t)},setter:function(t,r){return e.AttributeHelpers.coerceInteger(t)}},commentCount:{validator:function(t,r){return e.AttributeHelpers.validateInteger(t)},setter:function(t,r){return e.AttributeHelpers.coerceInteger(t)}},primary:{},primaryPhotoSizes:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(e){return this.getPrimaryUrlToFit(e)||void 0}},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/galleries/"+e+"/":void 0}},urlSuffix:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){return"gallery-"+this.getValue(e,"owner").getValue("pathAlias")+"-"+e}},coverPhotosData:[]}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getPhotos-fetcher","flickr-galleries-getContext-fetcher","flickr-galleries-addPhoto-creator","flickr-galleries-removePhoto-deletor","flickr-galleries-create-creator"],langBundles:["models"]});YUI.add("flickr-galleries-getPhotos-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-galleries-getPhotos"]={run:function(t,l){var r=this;return e.Promise.all([l.callAPI("flickr.galleries.getPhotos",this._processParams(t),!0),l.getModelRegistry("photo-models"),l.getModelRegistry("person-models"),l.getModelRegistry("gallery-models"),l.getModelRegistry("photo-engagement-models"),l.getModelRegistry("photo-stats-models"),l.getModelRegistry("gallery-info-models"),l.getModelRegistry("gallery-photo-models")]).then(function(e){return r._processResponse(e,t)},e.FetcherErrorLogger(o))},_processResponse:function(o,t){var l,r=o[0],s=o[1],a=o[2],g=o[3],i=o[4],n=o[5],p=o[6],d=o[7];if(r&&r.gallery)return r.gallery.owner=r.user,r.gallery.title=r.gallery.title&&r.gallery.title.content?r.gallery.title.content:r.gallery.title,r.gallery.description=r.gallery.description&&r.gallery.description.content?r.gallery.description.content:r.gallery.description,r.gallery.photoCount=r.gallery.countPhotos,r.gallery.videoCount=r.gallery.countVideos,e.APIHelper.response.addContextToRegistry(r.gallery,g,a),l=e.APIHelper.response.parsePhotos({photos:r.photos.photo,personModelRegistry:a,photoModelRegistry:s,photoEngagementModelRegistry:i,photoStatsModelRegistry:n}),g.setValue(t.id,"photoPageList",l),p.exists(t.id)&&p.getValue(t.id,"photoList").addPage({page:r.photos.page,perPage:r.photos.perpage,pageContent:l,totalItems:parseInt(r.photos.total||0,10)}),r.photos.photo.forEach(function(e,o){d.addOrUpdate({id:r.gallery.id+"-"+e.id,galleryId:r.gallery.id,photoId:e.id,remark:e.comment?e.comment._content:null})}),l},_processParams:function(o){return{gallery_id:o.id,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:o.perPage||1,page:o.page||1,get_user_info:1,get_gallery_info:1,primary_photo_extras:"url_sq, url_q, url_t, url_s, url_m"}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","gallery-models","photo-engagement-models","photo-stats-models","gallery-info-models"]});YUI.add("gallery-info-models",function(e,t){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-galleries-getInfo"].run(t,this.appContext)},updateMeta:function(t,r){return e.ModelUpdaters["flickr-galleries-editMeta"].run(t,r)},delete:function(t,r){return e.ModelDeletors["flickr-galleries-delete"].run(t,r)},removePhoto:function(t,r){return e.ModelDeletors["flickr-galleries-removePhoto"].run(t,r)},updatePrimaryPhoto:function(t,r){return e.ModelUpdaters["flickr-galleries-setPrimaryPhoto"].run(t,r)},updatePhotos:function(t,r){return e.ModelUpdaters["flickr-galleries-editPhotos"].run(t,r)},reorderPhotos:function(t,r){return e.ModelUpdaters["flickr-galleries-reorderPhotos"].run(t,r)},addPhoto:function(t,r){return e.ModelCreators["flickr-galleries-addPhoto"].run(t,r)}},updateMetaRemote:function(e,t){return t.galleryId=e,this.remote.updateMeta(t,this.appContext)},deleteRemote:function(e,t){return this.remote.delete(e,this.appContext)},getPrimaryPhotoUrl:function(t,r){return e.URLHelper.getFarmURL(this.getValue(t,"primary_photo_farm"),this.getValue(t,"primary_photo_server"),this.getValue(t,"primaryPhotoId"),this.getValue(t,"primary_photo_secret"),r)},hasPhoto:function(e,t){return this.getValue(e,"photoList").getFromListByID(t)},removePhotoRemote:function(e,t){return this.remote.removePhoto({galleryID:e,photoID:t},this.appContext)},updatePrimaryPhotoRemote:function(e,t){return this.remote.updatePrimaryPhoto({galleryId:e,photoId:t},this.appContext)},reorderPhotosRemote:function(e,t){return this.remote.reorderPhotos({galleryId:e,photoIds:t,currentState:this.getValue(e,"currentState"),userId:this.appContext.getViewer().nsid},this.appContext)},getCommentsByContinuation:function(t,r){return e.ListFetchers["flickr-galleries-comments-getList"].run({id:t,perPage:r,continuation:this.getValue(t,"commentsContinuation")},this.appContext)},addPhotoRemote:function(e,t){return this.remote.addPhoto({galleryID:e,photoID:t},this.appContext)},attributes:{id:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},compoundId:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(t){var r=this.getValue(t,"owner"),o=e.URLHelper.generatePersonUrls(r);return r?o.galleries+"/"+t:void 0}},owner:{isModel:!0},username:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},primaryPhotoId:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},primaryPhotoSizes:{},dateCreate:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},dateUpdate:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},viewCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},commentCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},title:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},description:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},photoList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-galleries-getPhotos"]}},comments:{isCollection:!0},commentsContinuation:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:"0"},currentState:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},primary_photo_server:{},primary_photo_farm:{},primary_photo_secret:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getInfo-fetcher","flickr-galleries-getPhotos-fetcher","flickr-galleries-comments-getList-fetcher","flickr-galleries-editMeta-updater","flickr-galleries-delete-deletor","flickr-galleries-removePhoto-deletor","flickr-galleries-setPrimaryPhoto-updater","flickr-galleries-editPhotos-updater","flickr-galleries-reorderPhotos-updater","url-helper"],langBundles:["models"]});YUI.add("flickr-galleries-getInfo-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-galleries-getInfo"]={run:function(o,t){var n=this,s=this._processParams(o);return e.FlickrPromise({apiResponse:t.callAPI("flickr.galleries.getInfo",s),galleryInfoModelRegistry:t.getModelRegistry("gallery-info-models"),personModelRegistry:t.getModelRegistry("person-models")}).then(function(e){return n._processResponse(e,o,t)},e.FetcherErrorLogger(r))},_processResponse:function(e,r,o){var t,n,s=e.apiResponse,i=e.galleryInfoModelRegistry,a=(e.personModelRegistry,e.personModel,s.gallery);if(a)return o.getModel("person-models",a.owner).then(function(e){return n=e,t={id:r.id,compoundId:a.id,owner:n,username:a.username,primaryPhotoId:a.primary_photo_id,dateCreate:parseInt(a.date_create),dateUpdate:parseInt(a.date_update),photoCount:a.count_photos,videoCount:a.count_videos,viewCount:parseInt(a.count_views),commentCount:parseInt(a.count_comments),title:a.title._content,description:a.description._content,currentState:a.current_state,primary_photo_server:a.primary_photo_server,primary_photo_farm:a.primary_photo_farm,primary_photo_secret:a.primary_photo_secret},i.addOrUpdate(t)})},_processParams:function(e){return{gallery_id:e.id}}}},"@VERSION@",{requires:["flickr-promise","api-helper","url-helper"],optional:["gallery-info-models","person-models"]});YUI.add("notifications-view",function(t,i){require("hermes-core/flog")(i);t.namespace("Views")[this.name]=t.Base.create("notifications-view",t.FlickrView,[],{langBundles:this.details.langBundles,registries:{person:"person-models",photo:"photo-models",group:"group-info-models",gallery:"gallery-models"},initializer:function(t){var i=this.appContext.getViewer();return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.nsid=i&&i.signedIn?i.nsid:void 0,t.nsid=this.nsid,this.pageNum=0,this.pageSize=30,this.isFetchingNotifs=!1,this.scrollBottomLoadDist=300,this.endOfNotifs=!1,this.shouldFetchNotifs=t.shouldFetchNotifs,this.height=t.height,this.width=t.width,this.listHeight=t.listHeight,this.overflowX=t.overflowX,this.overflowY=t.overflowY,this.notifFilter=t.notifFilter,this},loadState:function(){return this},buildContainer:function(){return this.setContainerWithTemplate("notifications",{notifications:[],height:this.height,width:this.width,listHeight:this.listHeight,overflowX:this.overflowX,overflowY:this.overflowY}),this},activate:function(){var t,i,e,o,n,s=this;return s.scrollContainer=s.get("container").one(".notifications-list"),s.scrollContainerElement=this.scrollContainer.getDOMNode(),this.registerEventHandler(s.scrollContainer.on("scroll",s.handleScrollNotifications.bind(s))),s.get("personNotificationsModels")?s.getMoreNotifications():(t=this.appContext.getViewer(),this.appContext.getModel("person-notifications-models",t.nsid).then(function(t){s.set("personNotificationsModels",t),e=t.getValue("notifications").size(),o=t.getValue("unseenNotificationCount"),s.shouldFetchNotifs&&0!==o||0===e||t.getValue("muteChanged")?(s.shouldFetchNotifs=!1,t.setValue("unseenNotificationCount",0),t.setValue("muteChanged",!1),s.get("container").one(".notifications-list").addClass("loading"),s.getMoreNotifications()):(n=t.getValue("notifications").getList(),s.pageNum=Math.floor(e/s.pageSize),s.appendPage(n)),(i=t.getValue("unreadFlickrMailCount"))&&0!==i&&s.get("container").one(".flickr-mail-count").setHTML(s.intlMessage({intlName:"notifications.FLICKR_MAIL_COUNT_PAREN",count:i}))})),this},handleflickrMailOpenAccountDropAroundClicked:function(i){i.stopPropagation(),i.preventDefault(),t.fire("notifications:openAccountMenuClicked"),t.fire("notifications:closeNotificationsMenuClicked")},handleflickrMailHasMovedClicked:function(t){t.stopPropagation(),t.preventDefault(),this.get("container").one(".notifications-flickrmail-has-moved-messaging-container").addClass("expand")},handleflickrMailHasMovedCloseClicked:function(t){t.stopPropagation(),t.preventDefault(),this.get("container").one(".notifications-flickrmail-has-moved-messaging-container").removeClass("expand")},handleScrollNotifications:function(t){this.isFetchingNotifs||this.scrollContainerElement.offsetHeight+this.scrollContainerElement.scrollTop+this.scrollBottomLoadDist>=this.scrollContainerElement.scrollHeight&&this.getMoreNotifications()},getMoreNotifications:function(){this.endOfNotifs||(this.isFetchingNotifs=!0,this.showBalls(this.get("container").one(".notifications-list")),this.retrieveNotifsPage())},appendPage:function(i){var e=this;i.forEach(function(i){var o=i.toJSON();o.appContext=e.appContext,o.notifModel=e.get("personNotificationsModels"),o.events&&0!==o.events.length&&new t.Views["notification-view"](o).initialize(o).then(function(n){var s=t.Node.create('<li class="notification-list-item"></li>');e.get("container").one(".notifications-list").append(s),o.seen||s.addClass("unseen"),s.setHTML(n.get("container")),i.setValue("seen",!0),n.activate()})})},showBalls:function(i){this.balls||(this.balls=t.Node.create('<li class="loading-balls"></li>'),this.balls.setHTML(this.templates("flickr-balls")({}))),(i||this.get("container")).append(this.balls)},hideBalls:function(){this.balls&&this.balls.remove()},retrieveNotifsPage:function(){var t=this,i=t.get("personNotificationsModels");return i.getValue("notifications").getPage({page:t.pageNum+1,apiParams:{filter:t.notifFilter}}).then(function(e){return 0!==e.length?(t.pageNum++,t.set("personNotifications",i.getValue("notifications")),t.appendPage(e)):(0===t.pageNum&&t.get("container").one(".notifications-empty-state").removeClass("hidden"),t.endOfNotifs=!0),t.get("container").one(".notifications-list").removeClass("loading"),t.hideBalls(),t.isFetchingNotifs=!1,t},function(t){}).then(function(t){t.registerEventHandler(t.get("container").all("a").on("focus",function(i){var e=i.target.ancestor("li");e&&t.findFocus.call(this,e)}.bind(t)))})},findFocus:function(t){var i,e=t.one("a.photo");e?e.focus():(i=t.one("a:first-child"))&&i.focus()}})},"@VERSION@",{requires:["flickr-view","hermes-template-notifications"],langBundles:["common","notifications"],optional:["person-notifications-models","notification-view","photo-models","group-info-models","person-models","gallery-models"]});YUI.add("notifications-menu-view",function(t){"use strict";t.namespace("Views")[this.name]=t.Base.create("notifications-menu-view",t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.pollingFailed=!1,this.shouldFetchNotifs=!0,this.notifFilter=["group_topic_new","user_gallery_comment"].join(","),""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("notifications-menu"),this},loadState:function(){var e=this,n=this.appContext.getViewer();return this.appContext.getModel("person-notifications-models",n.nsid).then(function(i){if(e.set("personNotificationsModel",i),Date.now()-i.getValue("unseenLastFetchedTimestamp")>t.config.flickr.notifications.loading_count_refetch_delay)return i.remoteReadUnseenNotificationCount({id:n.nsid,filter:e.notifFilter},e.appContext).then(null,function(t){e.pollingFailed=!0})})},buildContainer:function(){var t=this.formatCount99(this.get("personNotificationsModel").getValue("unseenNotificationCount"));return this.setContainerWithTemplate("notifications-menu",{unseenNotificationCount:t}),this},activate:function(){var e=this,n=e.get("personNotificationsModel");e.unseenBadge=e.get("container").one(".c-notification-unseencount"),e.unseenCount=0,e.notifIcon=e.get("container").one(".c-notification-icon"),0===n.getValue("unseenNotificationCount")?e.unseenBadge.addClass("hidden"):e.unseenBadge.removeClass("hidden"),t.on("notifications:closeNotificationsMenuClicked",function(t){e.droparound.close()}),this.registerEventHandler(this.get("container").on("click",e.openMenu.bind(e))),this.registerEventHandler(this.get("container").on("key",e.keyboardToggleMenu.bind(e),"down:13,32")),this.registerEventHandler(this.get("container").on("key",e.enterMenu.bind(e),"down:9,40")),e.pollForUnseenNotifs()},pollForUnseenNotifs:function(){this.pollIntervalId=setInterval(this.readUnseenNotifs.bind(this),t.config.flickr.notifications.polling_delay)},readUnseenNotifs:function(){var e=this,n=this.appContext.getViewer();e.get("personNotificationsModel").remoteReadUnseenNotificationCount({id:n.nsid,filter:e.notifFilter},e.appContext).then(function(t){e.shouldFetchNotifs=!0,t!==e.unseenCount&&(e.unseenCount=t,0!==t?(e.unseenBadge.removeClass("hidden"),e.unseenBadge.set("text",e.formatCount99(t))):e.unseenBadge.addClass("hidden"))},function(n){clearInterval(e.pollIntervalId),e.pollingFailed||(e.pollingFailedTimeoutId=setTimeout(e.pollForUnseenNotifs.bind(e),t.config.flickr.notifications.polling_failure_timeout)),e.pollingFailed=!0})},openMenu:function(){this.revealNotifications()},keyboardToggleMenu:function(t){t.preventDefault(),!this.droparound||this.droparound.isClosed?this.revealNotifications():this.droparound.close()},enterMenu:function(t){var e=t.keyCode;if(9===e&&!t.shiftKey&&"true"===t.target.getAttribute("aria-expanded")||40===e){t.preventDefault();var n=this.droparound.get("container").one("div.notifs-droparound");if(n){var i=n.one("a.mail-icon");this.registerEventHandler(i.on("key",this.enterNotificationsList.bind(this),"down:9,40")),i.focus()}}},enterNotificationsList:function(t){var e=t.keyCode;(9===e&&!t.shiftKey||40===e)&&(t.preventDefault(),this.droparound.get("subview").findFocus.call(this,this.droparound.get("container").one("div.notifs-droparound").one("ul").one("li:not(.hidden)")))},revealNotifications:function(){var e,n=this.appContext.viewportData.getWidth(),i=this.appContext.viewportData.getHeight(),o=n>700?60:67,s=n>700?"":n-2+"px",a=i>1e3?"800px":i-200+"px";(e=new t.Views["notifications-view"]({appContext:this.appContext,width:s,listHeight:a,shouldFetchNotifs:this.shouldFetchNotifs,notifFilter:this.notifFilter})).appContext=this.appContext,this.droparound=new t.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,anchorOffsetVertical:-4,anchorOffsetHorizontal:o,mirrorArrowAdjustment:o-11,showDropArrow:!0,contentPadding:0,classList:"notifs-droparound no-border big-shadow",anchorElement:this.get("container").one(".c-notification-icon"),subview:e,observePageResize:!0,positionFixed:!0,autoSizeToContent:!0,preventPageScrollOnScroll:!0}),this.droparound.show(),this.unseenBadge.addClass("hidden"),this.shouldFetchNotifs=!1},formatCount99:function(t){return t>=100?"99+":t},destructor:function(){clearInterval(this.pollIntervalId),clearTimeout(this.pollingFailedTimeoutId)}})},"@VERSION@",{requires:["flickr-view","hermes-template-notifications-menu","fluid-droparound-view","notifications-view"],langBundles:["notifications","common"]});YUI.add("hermes-template-person-card",function(a,n){var l=a.Template.Handlebars.revive({1:function(a,n,l,e,t){var s;return"\t\t\t\t\t"+a.escapeExpression(a.lambda(null!=(s=null!=n?n.person:n)?s.realname:s,n))+"\n\t\t\t\t\t"+(null!=(s=l.if.call(null!=n?n:{},null!=n?n.personLocation:n,{name:"if",hash:{},fn:a.program(2,t,0),inverse:a.noop,data:t}))?s:"")+"\n"},2:function(a,n,l,e,t){return" - "},4:function(a,n,l,e,t){var s;return null!=(s=l.each.call(null!=n?n:{},null!=n?n.photostream:n,{name:"each",hash:{},fn:a.program(5,t,0),inverse:a.noop,data:t}))?s:""},5:function(a,n,l,e,t){var s;return null!=(s=l.if.call(null!=n?n:{},null!=n?n.needsInterstitial:n,{name:"if",hash:{},fn:a.program(6,t,0),inverse:a.program(8,t,0),data:t}))?s:""},6:function(a,n,l,e,t){var s,r,i=null!=n?n:{},o=l.helperMissing,u=a.escapeExpression,c=a.lambda;return'\t\t\t\t\t<a href="'+u("function"==typeof(r=null!=(r=l.url||(null!=n?n.url:n))?r:o)?r.call(i,{name:"url",hash:{},data:t}):r)+'" title="'+u("function"==typeof(r=null!=(r=l.title||(null!=n?n.title:n))?r:o)?r.call(i,{name:"title",hash:{},data:t}):r)+'" width="'+u(c(null!=(s=null!=(s=null!=n?n.sizes:n)?s.sq:s)?s.width:s,n))+'" height="'+u(c(null!=(s=null!=(s=null!=n?n.sizes:n)?s.sq:s)?s.height:s,n))+'" style="background: url(https://combo.staticflickr.com/pw/images/spaceball.gif);" data-track="personCardRecentPhotosClick"></a>\n'},8:function(a,n,l,e,t){var s,r,i=null!=n?n:{},o=l.helperMissing,u=a.escapeExpression;return'\t\t\t\t\t<a href="'+u("function"==typeof(r=null!=(r=l.url||(null!=n?n.url:n))?r:o)?r.call(i,{name:"url",hash:{},data:t}):r)+'" title="'+u("function"==typeof(r=null!=(r=l.title||(null!=n?n.title:n))?r:o)?r.call(i,{name:"title",hash:{},data:t}):r)+'" style="background: url('+u(a.lambda(null!=(s=null!=(s=null!=n?n.sizes:n)?s.sq:s)?s.displayUrl:s,n))+');" data-track="personCardRecentPhotosClick"></a>\n'},10:function(a,n,l,e,t){return'\t\t\t<span class="tertiary">'+a.escapeExpression((l.intlMessage||n&&n.intlMessage||l.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"person.NO_PHOTOS"},data:t}))+"</span>\n"},compiler:[7,">= 4.0.0"],main:function(a,n,l,e,t){var s,r,i=null!=n?n:{},o=l.helperMissing,u=a.escapeExpression,c=a.lambda;return'\n<div>\n\t<section>\n\t\t<div class="follow-subview">'+u((l.outlet||n&&n.outlet||o).call(i,null!=n?n["follow-view"]:n,{name:"outlet",hash:{},data:t}))+'</div>\n\n\t\t<div class="attribution">\n\t\t\t<a href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.photostream:s,n))+'" data-track="personCardAttributionNameClick">\n\t\t\t\t<h3 class="fade-out">'+u(c(null!=(s=null!=n?n.person:n)?s.username:s,n))+'</h3>\n\t\t\t</a>\n\t\t</div>\n\t\t<div class="info">\n\t\t\t<span class="secondary realname fade-out">\n'+(null!=(s=l.if.call(i,null!=(s=null!=n?n.person:n)?s.realname:s,{name:"if",hash:{},fn:a.program(1,t,0),inverse:a.noop,data:t}))?s:"")+"\t\t\t\t"+u("function"==typeof(r=null!=(r=l.personLocation||(null!=n?n.personLocation:n))?r:o)?r.call(i,{name:"personLocation",hash:{},data:t}):r)+'\n\t\t\t</span>\n\t\t</div>\n\n\t\t<div class="recent-photos">\n'+(null!=(s=l.if.call(i,null!=n?n.photostream:n,{name:"if",hash:{},fn:a.program(4,t,0),inverse:a.program(10,t,0),data:t}))?s:"")+'\t\t</div>\n\t</section>\n</div>\n\n<div class="links secondary">\n\t<a href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.sendFlickrMail:s,n))+'" data-track="personCardMessageClick">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"person.MESSAGE"},data:t}))+'</a>\n\t<a href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.albums:s,n))+'" data-track="personCardAlbumsClick">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"person.ALBUMS"},data:t}))+'</a>\n\t<a href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.favorites:s,n))+'" data-track="personCardFavesClick">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"person.FAVES"},data:t}))+'</a>\n\t<a class="align-right" href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.profile:s,n))+'" data-track="personCardProfileClick">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"common.ABOUT"},data:t}))+"</a>\n</div>\n"},useData:!0}),e={};a.Array.each([],function(n){var l=a.Template.get("hermes/"+n);l&&(e[n]=l)}),a.Template.register("hermes/person-card",function(n,t){return t=t||{},t.partials=t.partials?a.merge(e,t.partials):e,l(n,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("person-card-view",function(e){e.namespace("Views")[this.name]=e.Base.create("person-card-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.set("isActiveViewAgnostic",e.isActiveViewAgnostic||!1),""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},subviewConfig:{"follow-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){var t=this,s={contentType:7};return this.nsid?s.id=this.nsid:s.pathAlias=this.pathAlias,new e.FlickrPromise({person:this.appContext.getModel("person-models",s),photostream:this.appContext.getModel("photostream-models",s),personProfile:this.appContext.getModel("person-profile-models",s)}).then(function(e){return t.personModel=e.person,t.personLocation=e.personProfile.getValue("location"),e.photostream.getValue("photoPageList").getPage({page:1,perPage:5}).then(function(e){t.photostreamPhotos=e})},function(e){t.loadingError=!0,1===e.code&&"User not found"===e.message&&(t.badUser=!0)})},buildContainer:function(){var t,s;return this.loadingError?(s=this.badUser?'<span class="no-user">'+this.intlMessage({intlName:"person.NO_LONGER_ON_FLICKR"})+"</span>":'<span class="error-user">'+this.intlMessage({intlName:"person.ERROR_LOADING"})+"</span>",this.setContainerHTML(s)):(t=this.personModel.toJSON(),this.setContainerWithTemplate("person-card",{person:t,photostream:this.photostreamPhotos.map(function(e){return e.toJSON()}),personLocation:this.personLocation,personURLS:e.URLHelper.generatePersonUrls(this.personModel)})),this},activate:function(){var e=this.get("container"),t=e.one(".follow-view"),s=t.one(".relationship"),o=t.one(".relationship > .is-following"),n=e.one(".attribution");return s?o&&n.addClass("shorter"):n.addClass("full"),this}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-person-card","url-helper"],langBundles:["person","common"]});