YUI.add("photo-list-view",function(t,e){"use strict";var i=require("hermes-core/flog")(e),o={containerWidth:"fullWidth",subtractScrollbarWidth:!1,pageParams:{page:1,perPage:50},parentName:"",subviewMapping:{"photo-models":{name:"photo-list-photo-view",params:null},"photo-lite-models":{name:"photo-list-photo-view",params:null},"set-models":{name:"photo-list-album-view",params:null}},paginateOnScroll:!0,keepAwakeOnScroll:!1,parentContainer:t.config.win,loadMoreMargin:3,relayoutOnResize:!0,recenterOnResize:!1,responsiveRowHeight:!1,maintainScrollPosition:!0,interactionViewName:"photo-list-photo-interaction-view",engagementModelName:"photo-engagement-models",itemFilterFunction:null,injectPhotolistContextParams:null,beaconViews:!0,scrollInterruptParams:null,scrollToWithId:!1,handleCollectionChanged:!1},n={480:.5,800:.75,1280:1,1600:1.25},a=Object.keys(n);t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){var n,a=t.merge(o,e.photoListConfig);if(void 0===a)throw new Error("photo-list-view must be initialized with config params wrapped in a `photoListConfig` object.");if(a.initialItems)this.initialItems=a.initialItems.concat(),a.paginateOnScroll=!1;else{if(void 0===a.modelParams)throw new Error("photo-list-view must be initialized with `modelParams`.");if(void 0===a.modelParams.registryName)throw new Error("photo-list-view must be initialized with `modelParams.registryName`.");if(void 0===a.modelParams.modelIdOrAttributes)throw new Error("photo-list-view must be initialized with `modelParams.modelIdOrAttributes`.");if(void 0===a.modelParams.collectionAttributeName)throw new Error("photo-list-view must be initialized with `modelParams.collectionAttributeName`.")}if(void 0===a.parentName)throw new Error("photo-list-view must be initialized with the `parentName` (the name of the module containing the photolist).");return this.parentName=a.parentName,this.modelParams=a.modelParams,this.pageParams=a.pageParams,this.subviewMapping=a.subviewMapping,this.loadMoreMargin=a.loadMoreMargin,this.relayoutOnResize=a.relayoutOnResize,this.recenterOnResize=a.recenterOnResize,this.responsiveRowHeight=a.responsiveRowHeight,this.contextSuffix=a.contextSuffix,this.initializeWithFirstPage=a.initializeWithFirstPage,!YUI.Env.isServer&&a.beaconViews&&(this.viewBeaconer={beaconer:this.appContext.getViewCounter(),beaconAttribute:a.viewBeaconAttribute||"id",beaconRestrictedAttribute:a.viewBeaconRestrictedAttribute||"needsInterstitial",beaconAlwaysBeacon:a.viewBeaconAlwaysBeacon||!1,beaconIsOwnerAttribute:a.viewBeaconIsOwnerAttribute||"isOwner"}),a.subtractScrollbarWidth?YUI.Env.isServer?this.scrollbarWidth=this.appContext.viewportData.scrollbarWidth:this.scrollbarWidth=t.OverflowHelper.detectScrollbarSize(t.one("body")):this.scrollbarWidth=0,a.layout?(a.layout instanceof t.PhotoListLayout?(i.warn("Passing a PhotoListLayout instance into PhotoListView is deprecated. Instead, send the layout config object, and PhotoListView will create the PhotoListLayout for you."),this.photoListLayout=a.layout):(this.isMobile&&a.mobileLayout&&(0===Object.keys(a.mobileLayout).length&&(a.mobileLayout={targetRowHeight:200,containerPadding:{right:16,left:16},itemSpacing:{horizontal:16,vertical:16}}),a.layout.targetRowHeight=a.mobileLayout.targetRowHeight||a.layout.targetRowHeight,a.layout.containerPadding=t.merge(a.layout.containerPadding||{},a.mobileLayout.containerPadding||{}),a.layout.itemSpacing=t.merge(a.layout.itemSpacing||{},a.mobileLayout.itemSpacing||{})),this.photoListLayout=new t.PhotoListLayout(t.merge(a.layout,{appContext:this.appContext}))),delete a.layout.appContext):this.photoListLayout=new t.PhotoListLayout({appContext:this.appContext}),this.photoListLayout.containerWidth||(YUI.Env.isServer||(n=this.appContext.flapp.get("activeView")),this.appContext.hasClientSideRouted()&&n&&n.name===this.parentName?this.photoListLayout.containerWidth=this.calculateContainerWidth("previousContainerWidth"):(this.explicitContainerWidth=a.containerWidth,this.photoListLayout.containerWidth=this.calculateContainerWidth(this.explicitContainerWidth))),this.baseRowHeight=this.photoListLayout.targetRowHeight,this.responsiveRowHeight&&this.adjustRowHeightToContainerWidth(),this.paginateOnScroll=a.paginateOnScroll,this.paginateOnScroll&&this.photoListLayout.layout&&this.photoListLayout.hasLimitedNumberOfRows()&&i.warn("When photo-list-layout::maxNumRows is specified, photo-list::paginateOnScroll should probably be set to `false`."),this.parentContainer=a.parentContainer,this.keepAwakeOnScroll=a.keepAwakeOnScroll,this.keepAwakeOnScroll&&(this.photoListLayout.sleepTopAndBottom=!1),this.loadingMoreBottom=!1,this.loadingMoreTop=!1,this.lastItemCached=!1,this.firstItemCached=!1,this.itemsMappedToAspectRatios=[],this.lowestPageInView=this.pageParams.page,this.highestPageInView=this.pageParams.page,this.pageParams.viewPageSize&&(this.lastPageInView=this.pageParams.page+Math.ceil(this.pageParams.viewPageSize/this.pageParams.perPage)-1,isNaN(this.lastPageInView)&&i.warn("Error calculating `this.lastPageInView`. Verify values passed for `config.pageParams`.")),this.modelsById={},this.subviewsById={},this.fetchedOnlyInitPage=!1,this.perPageDoubles=0,this.interactionViewName=a.interactionViewName,this.showInteractionBarPlaceholder=a.showInteractionBarPlaceholder||!1,this.interactionBarHeight=a.interactionBarHeight,this.engagementModelName=a.engagementModelName,this.maintainScrollPosition=a.maintainScrollPosition,this.scrollToWithId=a.scrollToWithId,this.handleCollectionChanged=a.handleCollectionChanged,this.itemFilterFunction=a.itemFilterFunction,a.injectPhotolistContextParams&&(this.injectPhotolistContextParams=t.merge(a.injectPhotolistContextParams)),""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),a.scrollInterruptParams&&(this.scrollInterruptParams=a.scrollInterruptParams,this.scrollInterruptState={nextInterrupt:this.scrollInterruptParams.pageCounts[0],numPagesLoaded:0,numInterrupts:0,isInterrupted:!1,footer:null,footerHeight:0}),this.isHidden=a.isHidden,delete e.photoListConfig,this.params=e,this},loadState:function(){var e,o,n=this;return this.initialItems?this.setItems(this.initialItems).then(this.loadStateSubviewsReady.bind(this),function(t){i.error("Error displaying initial items",{err:t})}):(e=t.merge(this.modelParams.fetchParams,this.pageParams),this.paginateOnScroll&&!this.scrollToWithId&&(e.page=2*(this.pageParams.page-1)+1,e.perPage=Math.floor(.5*this.pageParams.perPage),this.fetchedOnlyInitPage=!0),this.appContext.getModel(this.modelParams.registryName,this.modelParams.modelIdOrAttributes,e).then(function(i){var a,s=i.getValue(n.modelParams.collectionAttributeName),r=s.getList();if(n.set("collectionModel",i),n.lastPageInView)return(o=Math.min(s.getNextIncompletePage(n.pageParams),n.lastPageInView+1))<=n.pageParams.page?s.getPage(e):(a=s.getList().slice((n.pageParams.page-1)*n.pageParams.perPage,(o-1)*n.pageParams.perPage),t.Promise.resolve(a));var l=(e.page||1)*(e.perPage||0);return r.length&&(s.fetchedEnd||r.length>=l)&&!n.initializeWithFirstPage?t.Promise.resolve(r):s.getPage(e)},function(t){i.error("error fetching model",{err:t})}).then(function(e){var i=n.get("collectionModel").getValue(n.modelParams.collectionAttributeName),a=i.getList(),s=i.getFirstItem(),r=i.getLastItem();return e&&e.length?(n.lastPageInView?(n.lowestPageInView=n.pageParams.page,o===n.lastPageInView?n.highestPageInView=o-(Math.floor(n.pageParams.viewPageSize/n.pageParams.perPage)-1):n.highestPageInView=Math.max(n.lowestPageInView,o)):n.initializeWithFirstPage?(n.lowestPageInView=1,n.highestPageInView=1):(n.lowestPageInView=Math.floor(s.index/n.pageParams.perPage)+1,n.highestPageInView=Math.floor(r.index/n.pageParams.perPage)+1),!YUI.Env.isServer&&n.scrollInterruptState&&n.updateScrollInterruptState(n.highestPageInView-1),i.fetchedEnd&&e.length&&a.length&&e[e.length-1]&&a[a.length-1]&&e[e.length-1].id===a[a.length-1].id?n.lastItemCached=!0:n.highestPageInView>=n.lastPageInView&&(n.lastItemCached=!0),n.itemFilterFunction&&"function"==typeof n.itemFilterFunction&&(e=e.filter(n.itemFilterFunction)),n.layOutItems(e,"bottom")):t.Promise.resolve(null)},function(t){i.error("Calculate layout and generate subviews",{err:t})}).then(this.loadStateSubviewsReady.bind(this),function(t){i.warn("Error loading items from registry",{err:t,registry:n.modelParams.registryName,modelIdOrAttributes:n.modelParams.modelIdOrAttributes})}))},loadStateSubviewsReady:function(t){this.photoListLayout.getAwakeItems().length;YUI.Env.isServer||this.get("container").hasClass("requiredToShowOnServer")&&this.photoListLayout.containerWidth!==this.retrieveContainerWidth()&&(this._relayoutQueued=!0)},buildContainer:function(){return this.setContainerHTML(""),this.get("container").setStyle("height",this.containerHeight+"px"),this.initialLayoutResponse&&(this.renderSubviews(null,this.initialLayoutResponse),delete this.initialLayoutResponse),this},activate:function(){var e;return this._relayoutQueued&&(this._relayoutQueued=!1,this.initialLayoutResponse?(this.buildContainer(),this.storeContainerWidth(this.photoListLayout.containerWidth)):this.handleResize(null)),!this.paginateOnScroll&&this.keepAwakeOnScroll||(this.handleScroll(),this.parentContainer!==t.config.win&&this.parentContainer instanceof t.Node?this.registerEventHandler(this.parentContainer.on("scroll",this.handleScroll.bind(this))):this.registerEventHandler(t.globalEvents.subscribe("window:scroll",this.handleScroll.bind(this)))),this.relayoutOnResize&&this.registerEventHandler(t.globalEvents.subscribe("window:resize",this.handleResize.bind(this))),!YUI.Env.isServer&&this.maintainScrollPosition?this.photoListLayout.hasLimitedNumberOfRows()||(!(e=this.appContext.getReferrer())||e&&e!==this.appContext.flapp.getPath())&&this.restoreScrollPosition():!YUI.Env.isServer&&this.scrollToWithId&&this.scrollToId(this.scrollToWithId),this.injectPhotolistContextParams&&this.registerEventHandler(this.get("container").delegate("click",this.injectPhotolistContext.bind(this),"a")),this.registerEventHandler(this.get("container").delegate("click",this.subviewExtraToolClicked.bind(this),".extra-tool")),this.registerEventHandler(this.get("container").delegate("key",this.subviewExtraToolClicked.bind(this),"down:13",".extra-tool")),Object.keys(this.subviewMapping).some(function(t){return this.subviewMapping[t]&&"photo-list-tile-view"===this.subviewMapping[t].name}.bind(this))&&this.registerEventHandler(this.get("container").delegate("mouseenter",this.subviewLicenseMouseenter.bind(this),".license")),this.handleCollectionChanged&&this.registerEventHandler(this.get("collectionModel").on("valuesChanged",this.onCollectionModelValuesChanged.bind(this))),this.isHidden&&this.hide(),this.activateSubviews(),this},setItems:function(t,e){var i,o=this;return this.containerHeight=0,this.itemsMappedToAspectRatios=[],this.modelsById={},this.subviewsById={},this.get("collectionModel")&&((i=this.get("collectionModel").getValue(this.modelParams.collectionAttributeName)).fetchedStart?this.firstItemCached=!0:this.firstItemCached=!1,i.fetchedEnd&&!e?this.lastItemCached=!0:this.lastItemCached=!1),this.get("container").setHTML(""),this.photoListLayout.clear(),this.get("showThrobberDuringLoad")&&this.toggleThrobber(!0),this.layOutItems(t,"bottom").then(function(t){o.get("showThrobberDuringLoad")&&o.toggleThrobber(!1)})},getContainingElementData:function(){var e,i=this.get("container");return e={height:0,scrollLeft:0,scrollTop:0},e=this.parentContainer!==t.config.win&&this.parentContainer instanceof t.Node?{height:this.parentContainer.get("offsetHeight"),scrollLeft:this.parentContainer.getDOMNode().scrollLeft,scrollTop:this.parentContainer.getDOMNode().scrollTop}:{height:this.appContext.viewportData.getHeight(),scrollLeft:YUI.Env.isServer?0:t.config.win.pageXOffset,scrollTop:YUI.Env.isServer?0:t.config.win.pageYOffset},i&&(e.scrollLeft-=i.get("offsetLeft"),e.scrollTop-=i.get("offsetTop")),e},setContainerScrollTop:function(e){this.parentContainer!==t.config.win&&this.parentContainer instanceof t.Node?this.parentContainer.getDOMNode().scrollTop=e:t.config.win.scrollTo(0,e)},setTargetRowHeight:function(t){return this.photoListLayout.updateTargetRowHeight(t),this.handleResize(null,!0)},getSubview:function(t){return this.subviewsById[t]},handleScroll:function(e){var i,o,n,a=this,s=this.get("container"),r=s.get("clientHeight"),l=this.getContainingElementData(),h=l.height,c=l.scrollTop,d=!0;if(!this.isHidden){i=s.get("offsetParent").get("offsetTop")-s.get("offsetTop")+r,n=c+h;for(var u in this.subviewsById){d=!1;break}d||(!this.paginateOnScroll||this.scrollInterruptState&&this.scrollInterruptState.isInterrupted||((!this.lastPageInView||this.highestPageInView<this.lastPageInView)&&i-n<this.loadMoreMargin*h&&this.loadMore("bottom"),!this.lastPageInView&&c<this.loadMoreMargin*h&&this.lowestPageInView>1&&this.loadMore("top")),this.keepAwakeOnScroll||(o=this.photoListLayout.computeWakeSleep(l.scrollTop,l.scrollLeft),this.wakeOrSleepSubviews(o.wakeSleepChangedItems),!YUI.Env.isServer&&this.viewBeaconer&&o.inViewportChangedItems&&this.processInViewportItems(o.inViewportChangedItems)),void 0!==e&&(this.afterScrollTimeoutId&&t.config.win.clearTimeout(this.afterScrollTimeoutId),this.afterScrollTimeoutId=t.config.win.setTimeout(function(){a.paginateOnScroll&&a.storeScrollPosition(),a.paginateOnScroll&&!a.keepAwakeOnScroll&&a.validateWakeSleep(o),delete a.afterScrollTimeoutId},250)))}},handleResize:function(t,e){this.responsiveRowHeight&&this.adjustRowHeightToContainerWidth();var i,o,n=this.calculateContainerWidth(),a=this.get("container"),s=this.getContainingElementData(),r={diffType:"relayout",firstPage:this.firstItemCached,lastPage:this.lastItemCached};if(e||n-this.scrollbarWidth!==this.photoListLayout.containerWidth)return this.storeContainerWidth(n),this.photoListLayout.containerWidth=n-this.scrollbarWidth,i=this.photoListLayout.computeLayout(null,s.scrollTop,s.scrollLeft,r),this.containerHeight=i.containerHeight,this.scrollInterruptState&&this.scrollInterruptState.isInterrupted&&this.scrollInterruptState.loadMoreElement&&this.scrollInterruptState.loadMoreElement.setStyle("width",this.photoListLayout.containerWidth+"px"),a.setStyle("height",i.containerHeight+"px"),o=this.updateSubviews(i,"bottom"),this.recenterOnResize&&this.scrollToCenterItem(i.allLayoutItems),o},loadMore:function(e){"search-photos-lite-models"===this.modelParams.registryName&&this.modelParams.fetchParams&&this.modelParams.fetchParams.apiParams&&void 0!==this.modelParams.fetchParams.apiParams.page&&delete this.modelParams.fetchParams.apiParams.page;var o=this,n=this.get("collectionModel").getValue(this.modelParams.collectionAttributeName),a=n.getList(),s=t.merge(this.modelParams.fetchParams,this.pageParams);if("bottom"!==e||this.loadingMoreBottom)"top"!==e||this.loadingMoreTop||(s.page=this.lowestPageInView-1,o.lowestPageInView>1&&(this.loadingMoreTop=!0,n.getPage(s).then(function(t){n.fetchedStart&&t[0].id===n.getList()[0].id&&(o.firstItemCached=!0),o.lowestPageInView=o.lowestPageInView-1,o.layOutItems(t,e).then(function(t){o.loadingMoreTop=!1,o.paginateOnScroll&&(s.page<=0?i.warn("loadMore fetching beyond start of collection; aborting",{params:s}):o.handleScroll())})},function(t){i.error("loadMore page fetch failed",{err:t}),o.toggleThrobber(!1)})));else{if(this.fetchedOnlyInitPage?(s.page=2*(this.pageParams.page-1)+2,s.perPage=Math.floor(.5*this.pageParams.perPage)):s.page=this.highestPageInView+1,n.fetchedEnd&&this.lastItemCached)return;this.loadingMoreBottom=!0,this.scrollInterruptParams&&this.scrollInterruptParams.footerToHideWhileScrolling&&!this.scrollInterruptState.footer&&(this.scrollInterruptState.footer=t.one(this.scrollInterruptParams.footerToHideWhileScrolling),this.scrollInterruptState.footer&&(this.scrollInterruptState.footerHeight=this.scrollInterruptState.footer.get("clientHeight"),this.setFooterDisplay(!1))),this.get("showThrobberDuringLoad")&&this.toggleThrobber(!0),n.getPage(s).then(function(t){a=n.getList(),n.fetchedEnd&&t[t.length-1].id===a[a.length-1].id&&(o.lastItemCached=!0),o.fetchedOnlyInitPage?o.fetchedOnlyInitPage=!1:(s.perPageDoubling&&o.perPageDoubles<s.perPageDoubling&&(o.perPageDoubles++,o.pageParams.perPage*=2,o.highestPageInView=Math.floor(.5*o.highestPageInView),o.lastPageInView=Math.floor(.5*o.lastPageInView)),o.highestPageInView=o.highestPageInView+1),o.highestPageInView>=o.lastPageInView&&(o.lastItemCached=!0),o.itemFilterFunction&&"function"==typeof o.itemFilterFunction&&(t=t.filter(o.itemFilterFunction)),o.layOutItems(t,e).then(function(t){o.loadingMoreBottom=!1,o.paginateOnScroll&&(n.totalItems&&(s.page-1)*s.perPage>n.totalItems?i.warn("loadMore fetching beyond end of collection; aborting",{params:s,total:n.totalItems}):o.handleScroll())}),o.scrollInterruptState&&(o.lastItemCached?o.setFooterDisplay(!0):(o.scrollInterruptState.numPagesLoaded++,o.checkScrollInterruptionState())),o.get("showThrobberDuringLoad")&&o.toggleThrobber(!1)},function(t){i.error("loadMore page fetch failed",{err:t}),o.toggleThrobber(!1)})}},layOutItems:function(e,o,n){if(!e||!e.length)return t.Promise.resolve();var a,s,r,l=this.containerHeight,h={},c=this.get("container"),d=this.getContainingElementData();if(e=this.cacheModelsById(e),a=this.itemsToAspectRatios(e),"bottom"===o)this.itemsMappedToAspectRatios=this.itemsMappedToAspectRatios.concat(a),s=a,h.diffType="append",this.lastItemCached&&(h.lastPage=!0);else{if("top"!==o)return void i.warn("Unsupported `layOutItems` direction",{direction:o});this.itemsMappedToAspectRatios=a.concat(this.itemsMappedToAspectRatios),s=a,h.diffType="prepend",this.firstItemCached&&(h.firstPage=!0)}return n&&(h.diffType="relayout",h.diffDirection=o),r=this.photoListLayout.computeLayout(s,d.scrollTop,d.scrollLeft,h),c.setStyle("height",r.containerHeight+"px"),this.containerHeight=r.containerHeight,"top"===o&&this.setContainerScrollTop(this.containerHeight-l),this.updateSubviews(r,o)},updateSubviews:function(t,e){var o,n=this;return this.instantiateSubviews(t.newItems).then(function(i){return i=i.filter(function(t){return!!t}),n.updateSubviewGeometry(t.layoutChangedItems),n.isBuilt?(n.renderSubviews(i,t,e),n.activateSubviews(i),t.wakeSleepChangedItems.length&&(o=t.wakeSleepChangedItems.filter(function(e){return-1===t.newItems.indexOf(e)})).length&&n.wakeOrSleepSubviews(o),t.inViewportChangedItems.length&&n.processInViewportItems(t.inViewportChangedItems)):n.initialLayoutResponse=t,i},function(t){i.error("Error instantiating subviews",{err:t})})},instantiateSubviews:function(e){var o,n=[],a=this,s=this.get("container");e.forEach(function(e){(o=a.modelsById[e.id])?a.subviewsById[e.id]?n.push(t.Promise.resolve(a.subviewsById[e.id])):n.push((function(o,n){var r=t.merge(a.params,{id:e.id,parentSignature:a.getPhotolistSignature(),model:o,contextSuffix:a.contextSuffix,layoutItem:n,parentContainer:s,interactionViewName:a.interactionViewName,showInteractionBarPlaceholder:a.showInteractionBarPlaceholder,interactionBarHeight:a.interactionBarHeight,engagementModelName:a.engagementModelName}),l=a.subviewMapping[o.registry.name];return l.params&&(r=t.merge(r,l.params)).removePoolPhoto&&(r.listModelParams=a.modelParams),a.instantiateSubview(l.name,r).then(function(t){return t.initialize().then(function(t){return a.subviewsById[n.id]=t,a.subviews={},t},function(t){return i.warn("Error in lifecycle of subview",{err:t,view:l.name}),a.photoListLayout.invalidateItem(n.id),null})},function(t){i.warn("Error instantiating subview",{err:t,view:l.name})})})(o,e)):i.warn("Model missing from cache",{modelId:e.id})});var r=t.Promise.all(n);return r.then(function(t){return!YUI.Env.isServer&&a.viewBeaconer&&a.viewBeaconer.beaconer.flushQueue({avoidDuplicates:!0}),t}),r},renderSubviews:function(t,e,o){var n,a,s,r,l=this.get("container"),h=this;t||(t=[],e.allLayoutItems.forEach(function(e){var i=h.subviewsById[e.id];i&&t.push(i)})),o||(o="bottom"),YUI.Env.isServer?(n=t.map(function(t){return t.get("container").get("outerHTML")}),"top"===o?l.setHTML(n.join("")+l.getHTML()):"bottom"===o?l.setHTML(l.getHTML()+n.join("")):(i.warn("Unsupported `renderSubviews` direction; appending changed subviews.",{direction:o}),l.setHTML(l.getHTML()+n.join("")))):("top"===o&&t.reverse(),a=YUI.config.doc.createDocumentFragment(),t.forEach(function(t){t&&a.appendChild(t.get("container").getDOMNode())}),"top"===o?l.prepend(a):"bottom"===o?l.append(a):(i.warn("Unsupported `renderSubviews` direction; appending changed subviews.",{direction:o}),l.append(a))),s=e.wakeSleepChangedItems.filter(function(t){return-1!==e.newItems.indexOf(t)}),this.updateSubviewGeometry(s),this.keepAwakeOnScroll?(r=e.wakeSleepChangedItems.filter(function(t){return-1!==e.leadingOrphans.indexOf(t)||-1!==e.trailingOrphans.indexOf(t)}),s.forEach(function(t){t.isAwake=!0}),this.wakeOrSleepSubviews(s.concat(r))):this.wakeOrSleepSubviews(e.wakeSleepChangedItems)},updateSubviewGeometry:function(t){var e,o=this;t.forEach(function(t){(e=o.subviewsById[t.id])?e.updateGeometry?e.updateGeometry(t):e.get("container").setStyles({width:t.geometry.width+"px",height:t.geometry.height+"px",transform:"translate("+t.geometry.left+"px, "+t.geometry.top+"px)","-webkit-transform":"translate("+t.geometry.left+"px, "+t.geometry.top+"px)","-ms-transform":"translate("+t.geometry.left+"px, "+t.geometry.top+"px)"}):i.warn("Subview missing from cache for geometry update",{layoutItemId:t.id})})},wakeOrSleepSubviews:function(t){var e,o=this;t.forEach(function(t){(e=o.subviewsById[t.id])?e.wake&&e.sleep?t.isAwake?e.wake():e.sleep():e.get("container").setStyle("display",t.isAwake?"":"none"):i.warn("Subview missing from cache for wake/sleep update",{layoutItemId:t.id})})},processInViewportItems:function(e){var i,o=this;e.forEach(function(e){if(e.isInViewport){if(!(i=o.subviewsById[e.id]))return;!YUI.Env.isServer&&o.viewBeaconer&&o.viewBeaconer.beaconer&&i.get("model").registry.hasAttribute(o.viewBeaconer.beaconIsOwnerAttribute)&&!i.get("model").getValue(o.viewBeaconer.beaconIsOwnerAttribute)&&(o.viewBeaconer.beaconAlwaysBeacon||i.get("model").registry.hasAttribute(o.viewBeaconer.beaconRestrictedAttribute)&&!i.get("model").getValue(o.viewBeaconer.beaconRestrictedAttribute))&&o.viewBeaconer.beaconer.queue(i.get("model").getValue(o.viewBeaconer.beaconAttribute),t.config.win.document.location.href)}})},activateSubviews:function(t){if(!t){t=[];for(var e in this.subviewsById)t.push(this.subviewsById[e])}t.forEach(function(t){t.normalizedActivate()})},removeItems:function(t){var e=this;t.forEach(function(t){e.photoListLayout.invalidateItem(t.id),e.itemsMappedToAspectRatios=e.itemsMappedToAspectRatios.filter(function(e){return e.id!==t.id}),e.modelsById[t.id]&&delete e.modelsById[t.id],e.subviewsById[t.id]&&(e.subviewsById[t.id].destroy({remove:!0}),delete e.subviewsById[t.id])})},onCollectionModelValuesChanged:function(t,e){var i,o,n,a,s;if(t[this.modelParams.collectionAttributeName]&&t[this.modelParams.collectionAttributeName].listDiff&&(i=t[this.modelParams.collectionAttributeName].listDiff,!this.loadingMoreBottom&&!this.loadingMoreTop)){if(o=this.get("collectionModel").getValue(this.modelParams.collectionAttributeName),n=o.getList(),i.added.length){var r,l,h,c;a=i.added,-1!==(r=n.indexOf(a[0])-1)&&(l=n[r])&&this.modelsById[l.id]&&(s="bottom",o.fetchedEnd&&a[a.length-1].id===n[a.length-1].id&&(this.lastItemCached=!0)),-1!==(h=n.indexOf(a[a.length-1])+1)&&(c=n[h+1])&&this.modelsById[c.id]&&(s="top",o.fetchedStart&&a[0].id===n[0].id&&(this.firstItemCached=!0)),s&&this.layOutItems(a,s,e)}i.removed.length&&(this.removeItems(i.removed),this.handleResize(null,!0))}},toggleThrobber:function(t){var e=this.get("container"),i=this.get("throbberNode");void 0===t&&(t=!this.get("isThrobberShowing")),t?(e.setStyle("height",this.containerHeight+100+"px"),e.setStyle("position","relative"),i&&i.appendTo(e)):(i&&i.remove(),e.setStyle("position","initial")),this._set("isThrobberShowing",t)},checkScrollInterruptionState:function(t){if(this.scrollInterruptState||t){var e;if(this.scrollInterruptState.numPagesLoaded>=this.scrollInterruptState.nextInterrupt){if(this.scrollInterruptState.numInterrupts++,e=this.scrollInterruptParams.pageCounts[this.scrollInterruptParams.pageCounts.length-1],this.scrollInterruptState.numInterrupts>=this.scrollInterruptParams.pageCounts.length)switch(this.scrollInterruptParams.repeatMode){case"exponential":this.scrollInterruptState.nextInterrupt+=e*Math.pow(2,this.scrollInterruptState.numInterrupts-this.scrollInterruptParams.pageCounts.length);break;case"linear":default:this.scrollInterruptState.nextInterrupt+=e}else this.scrollInterruptState.nextInterrupt+=this.scrollInterruptParams.pageCounts[this.scrollInterruptState.numInterrupts];t||this.interruptScroll()}else this.get("container").setStyle("paddingBottom","0px")}},updateScrollInterruptState:function(t){this.scrollInterruptState.numPagesLoaded=t;for(var e=0;e<=t;e++)this.checkScrollInterruptionState(!0)},interruptScroll:function(){this.scrollInterruptState.isInterrupted||(this.scrollInterruptState.isInterrupted=!0,this.scrollInterruptState.loadMoreElement||(this.scrollInterruptState.loadMoreElement=t.Node.create(this.templates("infinite-scroll-load-more")({}))),this.get("container").append(this.scrollInterruptState.loadMoreElement),this.scrollInterruptState.loadMoreElementHeight||(this.scrollInterruptState.loadMoreElementHeight=parseInt(this.scrollInterruptState.loadMoreElement.getComputedStyle("height").replace("px",""),10)+20,this.registerEventHandler(this.scrollInterruptState.loadMoreElement.on("click",this.onLoadMoreClicked.bind(this))),this.scrollInterruptState.loadMoreElement.setStyles({width:this.photoListLayout.containerWidth+"px",bottom:this.photoListLayout.containerPadding.bottom+"px"})),this.setFooterDisplay(!0),this.get("container").setStyle("paddingBottom",this.scrollInterruptState.loadMoreElementHeight+"px"))},onLoadMoreClicked:function(e){var i,o=t.config.win.pageYOffset;this.scrollInterruptState.isInterrupted&&(this.scrollInterruptState.isInterrupted=!1,this.scrollInterruptState.loadMoreElement.remove(),this.setFooterDisplay(!1),this.get("container").setStyle("paddingBottom",this.scrollInterruptState.footerHeight+this.scrollInterruptState.loadMoreElementHeight-100+"px"),this.loadMore("bottom"),i=t.config.win.pageYOffset,t.config.win.scrollBy(0,o-i))},setFooterDisplay:function(t){this.scrollInterruptState.footer&&(t?this.scrollInterruptState.footer.removeClass("infinite-scroll-hide-footer"):this.scrollInterruptState.footer.addClass("infinite-scroll-hide-footer"),this.fire("subviewViewEvent","footerDisplayChanged"))},cacheModelsById:function(t){if(t&&t.length){var e=this.modelsById,i=[];return t.forEach(function(t){t&&!e[t.id]&&(e[t.id]=t,i.push(t))}),i}},itemsToAspectRatios:function(t){var e=[],i=this.photoListLayout.forceAspectRatio,o=void 0!==i&&!isNaN(i),n=i||1;return t.forEach(function(t){void 0!==t&&e.push({id:t.id,aspectRatio:o?n:t.getValue("aspectRatio")})}),e},calculateContainerWidth:function(e){if(e||(e=this.explicitContainerWidth),"number"==typeof e)return e;var i,o;switch(e){case"previousContainerWidth":o=this.getContainerWidthFromCache();break;case"fullWidth":default:YUI.Env.isServer||(this.isActiveAndInDOM()?o=this.get("container").get("clientWidth")-this.scrollbarWidth:(i=this.get("container"),this.isBuilt&&i||(i=t.one("."+this.parentName)),i&&(o=parseInt(i.getStyle("width"))))),o||(o=this.getContainerWidthFromCache())}return o},getContainerWidthFromCache:function(){var t;return(t=this.retrieveContainerWidth())||(t=this.appContext.viewportData.getWidth()-this.scrollbarWidth),this._relayoutQueued=!0,t},adjustRowHeightToContainerWidth:function(t){var e,i,o,s,r;if((t=this.calculateContainerWidth(t))<a[0])i=this.baseRowHeight*n[a[0]];else if(t>a[a.length-1])i=this.baseRowHeight*n[a[a.length-1]];else for(r=0;r<a.length-1;r++)if(o=a[r],s=a[r+1],(e=(t-o)/(s-o))>=0&&e<=1){i=this.baseRowHeight*n[o]+e*this.baseRowHeight*(n[s]-n[o]);break}this.photoListLayout.targetRowHeight=i},storeContainerWidth:function(t){var e=this.parentName;e&&this.appContext.viewportData.setContainerWidth(e,t)},retrieveContainerWidth:function(){var t=this.parentName;return t?this.appContext.viewportData.getContainerWidth(t):0},getLayoutItemsOnScreen:function(t){if(YUI.Env.isServer)return[];var e,i,o=this.get("container"),n=this.getContainingElementData();return e=n.scrollTop-o.getXY()[1],i=e+n.height,t||(t=this.photoListLayout.getCurrentLayout())?t.filter(function(t){return t.geometry.top+t.geometry.height>e&&t.geometry.top<i}):[]},scrollToCenterItem:function(e){if(!this.photoListLayout.hasLimitedNumberOfRows()&&0!==this.getContainingElementData().scrollTop){var i,o=this.photoListLayout.getCurrentLayout(),n=this.get("container").getXY()[1],a=this;this.layoutItemAtScreenCenter||(i=this.getLayoutItemsOnScreen(o),this.layoutItemAtScreenCenter=i[Math.floor(.5*i.length)]),e.some(function(e){if(e.id===a.layoutItemAtScreenCenter.id)return a.parentContainer!==t.config.win&&a.parentContainer instanceof t.Node?a.parentContainer.getDOMNode().scrollTop=n+e.geometry.top+.5*(e.geometry.height-a.parentContainer.get("offsetHeight")):t.config.win.scrollTo(0,n+e.geometry.top+.5*(e.geometry.height-a.appContext.viewportData.getHeight())),!0}),this.deleteResizeCenterTimeoutId&&t.config.win.clearTimeout(this.deleteResizeCenterTimeoutId),this.deleteResizeCenterTimeoutId=t.config.win.setTimeout(function(){a.layoutItemAtScreenCenter&&(delete a.layoutItemAtScreenCenter,delete a.deleteResizeCenterTimeoutId)},1e3)}},storeScrollPosition:function(){var e=this.getLayoutItemsOnScreen();e.length&&t.StorageHelper.setItem(this.getPhotolistSignature(),e[0].id,!0)},restoreScrollPosition:function(){this.scrollToId(null,!0)},scrollToId:function(e,i){var o,n,a=this.get("container");e||(e=t.StorageHelper.getItem(this.getPhotolistSignature(),!0)),
(o=this.photoListLayout.getLayoutItem(e))&&(!o.geometry||o.geometry.top-this.photoListLayout.containerPadding.top<=0||(n=a.get("offsetParent")?a.get("offsetParent").get("offsetTop")+a.get("offsetTop"):a.get("offsetTop"),t.one(".global-nav-view")&&!i&&(n-=t.one(".global-nav-view").get("offsetHeight")),t.one(".fluid-subnav")&&!i&&(n-=t.one(".fluid-subnav").get("offsetHeight")),i&&(n+=50),this.setContainerScrollTop(o.geometry.top+n)))},validateWakeSleep:function(t){var e,i,o,n,a=this.photoListLayout.getAwakeItems(),s=t.allLayoutItems.indexOf(a[0]),r=t.allLayoutItems.indexOf(a[a.length-1]),l=[];for(e=s;e<r;e++)i=t.allLayoutItems[e],(o=this.subviewsById[i.id])&&((n=!i.isAwake)||(n=o.isAwake?!o.isAwake():0===o.get("container").get("children").size()),n&&i&&(i.isAwake=!0,l.push(i)));l.length&&this.wakeOrSleepSubviews(l)},getPhotolistSignature:function(){var e,i,o,n=0;if(!this.signature){if(YUI.Env.isServer){if(e=this.appContext.request.path,this.appContext.request.query)for(i in this.appContext.request.query)t.config.flickr.routing_params.indexOf(i)<0&&(e+=i+this.appContext.request.query[i]);e=t.flutil.normalizeURIComponents(e)}else e=t.flutil.normalizeURIComponents(t.config.win.location.pathname+t.config.win.location.search);if(this.modelParams)if("string"!=typeof this.modelParams.modelIdOrAttributes)for(i in this.modelParams.modelIdOrAttributes)e+=i+""+this.modelParams.modelIdOrAttributes[i];else e+=this.modelParams.modelIdOrAttributes;for(this.parentName&&(e+=this.parentName),e=(e=e.toLowerCase()).replace(/\W/g,""),o=0;o<e.length;o++)n+=e.charCodeAt(o);this.signature="photolist-"+n.toString(36)}return this.signature},injectPhotolistContext:function(e){var o,n,a,s,r,l,h,c,d=e.currentTarget.getAttribute("href"),u=t.URLHelper.PHOTOPAGE_PATTERN.exec(d),g="";if(u&&u.length>=5){if(o=this.get("collectionModel").getValue(this.modelParams.collectionAttributeName).getList().map(function(t){return t.id}).filter(function(t){return!!t}),s=u[4],-1===(r=o.indexOf(s)))return void i.warn("Clicked photo id not found in photolist. Aborting photolist injection and passing through to photopage.");(n=o.slice(r,r+50)).length<50&&(a=Math.max(0,r-(50-n.length)),n=o.slice(a,r).concat(n)),d.indexOf("#")>-1&&(d=(c=d.split("#"))[0],g="#"+c[1]),"/"===d.substr(-1)&&(d=d.substr(0,d.length-1)),l=d+"/in/photolist-"+t.URLHelper.generateShortenedPhotolist(n)+g,e.halt(),this.injectPhotolistContextParams&&this.injectPhotolistContextParams.rapidBeaconConfig&&((h={})[this.injectPhotolistContextParams.rapidBeaconConfig.itemIndexKey]=r+1,t.rapidTracker.beacon(this.name,this.injectPhotolistContextParams.rapidBeaconConfig.beaconName,h)),e.metaKey||e.ctrlKey||e.which&&2===e.which?t.config.win.open(l,"_blank"):this.appContext.flapp.navigate(l)}},subviewExtraToolClicked:function(e){var i,o=e.target.getDOMNode(),n=o.dataset.id,a=this.modelsById[n];if(n&&a){if(o.classList.contains("more-menu")){var s=[],r=o.dataset.menuItems.split(",");r&&(r.indexOf("search-similar")>-1&&s.push({text:this.intlMessage({intlName:"common.SEARCH_FOR_SIMILAR_PHOTOS"}),callback:function(e,i){var o=a.getValue("similaritySearchURL");i.metaKey||i.ctrlKey||i.which&&2===i.which?t.config.win.open(o,"_blank"):this.appContext.flapp.navigate(o)}.bind(this)}),r.indexOf("search-similar-with-term")>-1&&"search-photos-lite-models"===this.modelParams.registryName&&this.modelParams.fetchParams&&this.modelParams.fetchParams.apiParams&&this.modelParams.fetchParams.apiParams.text&&s.push({text:this.intlMessage({intlName:"common.SEARCH_FOR_SIMILAR_PHOTOS_WITH_TERM"}),callback:function(e,i){var o=a.getValue("basicSimilaritySearchURL")+"&text="+this.modelParams.fetchParams.apiParams.text;i.metaKey||i.ctrlKey||i.which&&2===i.which?t.config.win.open(o,"_blank"):this.appContext.flapp.navigate(o)}.bind(this)}),r.indexOf("exclude-people")>-1&&s.push({text:this.intlMessage({intlName:"common.HIDE_PHOTOS_FROM_PERSON"}),callback:function(){this.fire("subviewViewEvent","bigScotch",a.getValue("ownerNsid"),n)}.bind(this)}),r.indexOf("ban-user")>-1&&(i=function(t){this.fire("subviewViewEvent","banUser"+(t?"AndRemove":""),a.getValue("owner").id)},s.push({text:this.intlMessage({intlName:"common.GROUP_BAN_USER"}),callback:i.bind(this,!1)}),s.push({text:this.intlMessage({intlName:"common.GROUP_BAN_USER_REMOVE_PHOTOS"}),callback:i.bind(this,!0)})),r.indexOf("remove-user")>-1&&(i=function(t){this.fire("subviewViewEvent","removeUser"+(t?"AndRemove":""),a.getValue("owner").id)},s.push({text:this.intlMessage({intlName:"common.GROUP_REMOVE_USER"}),callback:i.bind(this,!1)}),s.push({text:this.intlMessage({intlName:"common.GROUP_REMOVE_USER_REMOVE_PHOTOS"}),callback:i.bind(this,!0)}))),s.length&&this.openSubviewMenu(e.target,s,this.subviewsById[n])}else o.classList.contains("remove-photo")?(this.fire("subviewViewEvent","photoList:removePhoto",n),o.classList.contains("remove-fave")?this.appContext.getModelRegistry(this.engagementModelName).then(function(e){return e.remoteDelete({photoId:n,userId:this.modelParams.modelIdOrAttributes.id||this.modelParams.modelIdOrAttributes}).then(function(t){this.get("collectionModel").getValue(this.modelParams.collectionAttributeName).remove(a)}.bind(this),function(e){new t.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.OOPS"}),showActionButton:!0,showCancelButton:!1,textMessage:this.intlMessage({intlName:"common.PHOTO_REMOVE_ERROR"})}).show()}.bind(this))}.bind(this)):o.classList.contains("remove-group-pool")?this.get("collectionModel").removePhotoRemote(n).then(function(t){this.get("collectionModel").getValue(this.modelParams.collectionAttributeName).remove(a)}.bind(this),function(e){new t.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.OOPS"}),showActionButton:!0,showCancelButton:!1,textMessage:this.intlMessage({intlName:"common.PHOTO_REMOVE_ERROR"})}).show()}.bind(this)):o.classList.contains("remove-showcase-photo")?this.fire("subviewViewEvent","showcase:remove",a,n):o.classList.contains("remove-photosof-you")?this.fire("subviewViewEvent","photosofyou:remove",a,n):o.classList.contains("remove-own-photo")&&this.fire("subviewViewEvent","ownphoto:remove",a,n)):o.classList.contains("big-scotch")&&this.fire("subviewViewEvent","scotch:big",a.getValue("ownerNsid"),n);e.halt()}},openSubviewMenu:function(e,i,o){var n,a,s,r,l,h=new t.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:e,positionFixed:!1,preferBottom:!0,dismissOnOverlayClick:!0,closeOnScroll:!0,mirrorArrowAdjustment:-3,menuItems:i}),c=this;this.registerEventHandler(h.on("selected",function(t){t&&t.menuItem&&t.menuItem.callback&&t.menuItem.callback(t.menuItem.selected,t.origEvent)})),l=h.on("closeDroparound",function(t){c.detachRegisteredEvent(l),c.detachRegisteredEvent(n),c.detachRegisteredEvent(a),s&&clearTimeout(s),o.setHoverVisible&&o.setHoverVisible(!1)}),this.registerEventHandler(l),h.show(),n=h.get("container").on("mouseleave",function(t){if(h){var e=o.get("container");if(e){var i=e.getDOMNode().getBoundingClientRect();(t.clientX<i.left||t.clientX>i.right||t.clientY<i.top||t.clientY>i.bottom)&&h.close()}}}),this.registerEventHandler(n),a=t.one("document").on("mousemove",t.betterThrottle(function(t){s&&clearTimeout(s),s=setTimeout(function(){r(t)},200)})),this.registerEventHandler(a),r=function(t){if(h){var e=h.getDroparoundContainer(),i=o.get("container");if(i&&e){var n=i.getDOMNode().getBoundingClientRect(),a=e.getDOMNode().getBoundingClientRect();!(t.clientX<n.left||t.clientX>n.right||t.clientY<n.top||t.clientY>n.bottom)||t.clientX>a.left&&t.clientX<a.right&&t.clientY>a.top&&t.clientY<a.bottom||h.close()}}},o.setHoverVisible&&o.setHoverVisible(!0)},subviewLicenseMouseenter:function(e){var i,o=e.currentTarget&&e.currentTarget.getData("license-type")&&e.currentTarget.getData("license-type").toString();o&&(this.licenseTooltipHoverTimer&&clearTimeout(this.licenseTooltipHoverTimer),this.licenseTooltip&&this.licenseTooltip.close(),this.licenseTooltipHoverTimer=setTimeout(function(){this.licenseTooltip=new t.Views.FluidDroparound({appContext:this.appContext,anchorElement:e.target,showDropArrow:!0,positionFixed:!1,preferBottom:!0,invisibleOverlay:!0,autoSizeToContent:!0,width:300,classList:"license-tooltip",htmlMessage:this.templates("license-detail")({title:"common.LICENSE_TITLE_"+o,body:"common.LICENSE_DESC_"+o})}),this.licenseTooltip.show()}.bind(this),300),i=this.get("container").delegate("mouseleave",function(t){this.licenseTooltip&&this.licenseTooltip.close(),i.detach(),clearTimeout(this.licenseTooltipHoverTimer)}.bind(this),".license"),this.registerEventHandler(i))},show:function(){this.isHidden=!1,this.get("container").setStyle("display","block")},hide:function(){this.isHidden=!0,this.get("container").setStyle("display","none")}},{ATTRS:{showThrobberDuringLoad:{value:!0,validator:function(e,i){return t.AttributeHelpers.validateBoolean(e)}},isThrobberShowing:{readOnly:!0,value:!1},throbberNode:{readOnly:!0,getter:function(e){return YUI.Env.isServer||void 0!==e||(e=t.Node.create('<div style="position: absolute; bottom: 40px; left: 0; right: 0;"><div class="flickr-dots"></div></div>'),this._set("throbberNode",e)),e}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-infinite-scroll-load-more","hermes-template-license-detail","photo-list-layout","photo-list-photo-view","overflow-helper","storage-helper","attribute-helpers","url-helper","paged-collection","fluid-droparound-view"],optionalRequires:["global-events"],langBundles:["common"]});YUI.add("hermes-template-fluid-modal",function(n,l){var t=n.Template.Handlebars.revive({1:function(n,l,t,a,e){return" html-modal"},3:function(n,l,t,a,e){return" subview-modal"},5:function(n,l,t,a,e){return" flex-layout"},7:function(n,l,t,a,e){return'<div class="close-x" aria-label="'+n.escapeExpression((t.intlMessage||l&&l.intlMessage||t.helperMissing).call(null!=l?l:{},{name:"intlMessage",hash:{intlName:"common.CLOSE"},data:e}))+'" tabindex="0"></div>'},9:function(n,l,t,a,e){var i;return'\t\t<div class="head">\n'+(null!=(i=t.if.call(null!=l?l:{},null!=l?l.navBarView:l,{name:"if",hash:{},fn:n.program(10,e,0),inverse:n.program(12,e,0),data:e}))?i:"")+'\t\t\t<div class="extra"></div>\n\t\t</div>\n'},10:function(n,l,t,a,e){return'\t\t\t\t<div class="nav"></div>\n'},12:function(n,l,t,a,e){var i;return'\t\t\t\t<div class="title">\n'+(null!=(i=t.if.call(null!=l?l:{},null!=l?l.title:l,{name:"if",hash:{},fn:n.program(13,e,0),inverse:n.program(15,e,0),data:e}))?i:"")+"\t\t\t\t</div>\n"},13:function(n,l,t,a,e){var i;return"\t\t\t\t\t\t"+n.escapeExpression("function"==typeof(i=null!=(i=t.title||(null!=l?l.title:l))?i:t.helperMissing)?i.call(null!=l?l:{},{name:"title",hash:{},data:e}):i)+"\n"},15:function(n,l,t,a,e){return"\t\t\t\t\t\t"+n.escapeExpression((t.renderTrustedMarkup||l&&l.renderTrustedMarkup||t.helperMissing).call(null!=l?l:{},null!=l?l.htmlTitle:l,{name:"renderTrustedMarkup",hash:{},data:e}))+"\n"},17:function(n,l,t,a,e){return" lines"},19:function(n,l,t,a,e){var i,r,s=null!=l?l:{},o=t.helperMissing;return'\t\t\t<div\n\t\t\t\tclass="content text-only '+(null!=(i=t.if.call(s,null!=l?l.noScroll:l,{name:"if",hash:{},fn:n.program(20,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(s,null!=l?l.showFooter:l,{name:"if",hash:{},fn:n.program(22,e,0),inverse:n.noop,data:e}))?i:"")+'"\n\t\t\t\tstyle="'+(null!=(i=(t.ifDefined||l&&l.ifDefined||o).call(s,null!=l?l.contentPadding:l,{name:"ifDefined",hash:{},fn:n.program(24,e,0),inverse:n.noop,data:e}))?i:"")+'">\n\t\t\t\t'+n.escapeExpression("function"==typeof(r=null!=(r=t.textMessage||(null!=l?l.textMessage:l))?r:o)?r.call(s,{name:"textMessage",hash:{},data:e}):r)+"\n\t\t\t</div>\n"},20:function(n,l,t,a,e){return" no-scroll"},22:function(n,l,t,a,e){return" has-footer"},24:function(n,l,t,a,e){var i,r,s=null!=l?l:{},o=t.helperMissing,u=n.escapeExpression;return"\n\t\t\t\t\tpadding-right: "+u("function"==typeof(r=null!=(r=t.contentPadding||(null!=l?l.contentPadding:l))?r:o)?r.call(s,{name:"contentPadding",hash:{},data:e}):r)+"px;\n\t\t\t\t\t"+(null!=(i=t.if.call(s,null!=l?l.showFooter:l,{name:"if",hash:{},fn:n.noop,inverse:n.program(25,e,0),data:e}))?i:"")+"\n\t\t\t\t\tpadding-left: "+u("function"==typeof(r=null!=(r=t.contentPadding||(null!=l?l.contentPadding:l))?r:o)?r.call(s,{name:"contentPadding",hash:{},data:e}):r)+"px;\n\t\t\t\t"},25:function(n,l,t,a,e){var i;return"padding-bottom: "+n.escapeExpression("function"==typeof(i=null!=(i=t.contentPadding||(null!=l?l.contentPadding:l))?i:t.helperMissing)?i.call(null!=l?l:{},{name:"contentPadding",hash:{},data:e}):i)+"px;"},27:function(n,l,t,a,e){var i,r=null!=l?l:{},s=t.helperMissing;return'\t\t\t<div\n\t\t\t\tclass="content html-only '+(null!=(i=t.if.call(r,null!=l?l.noScroll:l,{name:"if",hash:{},fn:n.program(20,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(r,null!=l?l.showFooter:l,{name:"if",hash:{},fn:n.program(22,e,0),inverse:n.noop,data:e}))?i:"")+'"\n\t\t\t\tstyle="'+(null!=(i=(t.ifDefined||l&&l.ifDefined||s).call(r,null!=l?l.contentPadding:l,{name:"ifDefined",hash:{},fn:n.program(24,e,0),inverse:n.noop,data:e}))?i:"")+'">\n\t\t\t\t'+n.escapeExpression((t.renderTrustedMarkup||l&&l.renderTrustedMarkup||s).call(r,null!=l?l.htmlMessage:l,{name:"renderTrustedMarkup",hash:{},data:e}))+"\n\t\t\t</div>\n"},29:function(n,l,t,a,e){var i,r=null!=l?l:{};return'\t\t\t<div\n\t\t\t\tclass="content subview '+(null!=(i=t.if.call(r,null!=l?l.noScroll:l,{name:"if",hash:{},fn:n.program(20,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(r,null!=l?l.showFooter:l,{name:"if",hash:{},fn:n.program(22,e,0),inverse:n.noop,data:e}))?i:"")+'"\n\t\t\t\tstyle="'+(null!=(i=(t.ifDefined||l&&l.ifDefined||t.helperMissing).call(r,null!=l?l.contentPadding:l,{name:"ifDefined",hash:{},fn:n.program(24,e,0),inverse:n.noop,data:e}))?i:"")+'"></div>\n'},31:function(n,l,t,a,e){var i;return'\t\t<div class="foot">\n'+(null!=(i=t.if.call(null!=l?l:{},null!=(i=null!=l?l.buttons:l)?i.visible:i,{name:"if",hash:{},fn:n.program(32,e,0),inverse:n.noop,data:e}))?i:"")+"\t\t</div>\n"},32:function(n,l,t,a,e){var i,r=null!=l?l:{};return'\t\t\t<div class="buttons">\n\t\t\t\t<div class="flavor-text-container">\n'+(null!=(i=t.if.call(r,null!=(i=null!=l?l.buttons:l)?i.flavorText:i,{name:"if",hash:{},fn:n.program(33,e,0),inverse:n.noop,data:e}))?i:"")+'\t\t\t\t</div>\n\t\t\t\t<div class="button-container">\n\t\t\t\t\t'+(null!=(i=t.if.call(r,null!=(i=null!=(i=null!=l?l.buttons:l)?i.cancel:i)?i.visible:i,{name:"if",hash:{},fn:n.program(36,e,0),inverse:n.noop,data:e}))?i:"")+"\n\t\t\t\t\t"+(null!=(i=t.if.call(r,null!=(i=null!=(i=null!=l?l.buttons:l)?i.action:i)?i.visible:i,{name:"if",hash:{},fn:n.program(38,e,0),inverse:n.noop,data:e}))?i:"")+"\n\t\t\t\t</div>\n\t\t\t</div>\n"},33:function(n,l,t,a,e){var i,r=null!=l?l:{};return'\t\t\t\t\t<div class="flavor-text secondary'+(null!=(i=t.unless.call(r,null!=(i=null!=(i=null!=l?l.buttons:l)?i.flavorText:i)?i.visible:i,{name:"unless",hash:{},fn:n.program(34,e,0),inverse:n.noop,data:e}))?i:"")+'">'+n.escapeExpression((t.renderTrustedMarkup||l&&l.renderTrustedMarkup||t.helperMissing).call(r,null!=(i=null!=(i=null!=l?l.buttons:l)?i.flavorText:i)?i.text:i,{name:"renderTrustedMarkup",hash:{},data:e}))+"</div>\n"},34:function(n,l,t,a,e){return" hidden"},36:function(n,l,t,a,e){var i;return'<button class="mini alt cancel">'+n.escapeExpression(n.lambda(null!=(i=null!=(i=null!=l?l.buttons:l)?i.cancel:i)?i.label:i,l))+"</button>"},38:function(n,l,t,a,e){var i,r=null!=l?l:{};return'<button class="mini '+(null!=(i=t.if.call(r,null!=(i=null!=(i=null!=l?l.buttons:l)?i.action:i)?i.isDangerous:i,{name:"if",hash:{},fn:n.program(39,e,0),inverse:n.noop,data:e}))?i:"")+' action"'+(null!=(i=t.if.call(r,null!=(i=null!=(i=null!=l?l.buttons:l)?i.action:i)?i.disabled:i,{name:"if",hash:{},fn:n.program(41,e,0),inverse:n.noop,data:e}))?i:"")+">"+n.escapeExpression(n.lambda(null!=(i=null!=(i=null!=l?l.buttons:l)?i.action:i)?i.label:i,l))+"</button>"},39:function(n,l,t,a,e){return"danger"},41:function(n,l,t,a,e){return' disabled="disabled"'},compiler:[7,">= 4.0.0"],main:function(n,l,t,a,e){var i,r,s=null!=l?l:{};return'<div class="modal'+(null!=(i=t.if.call(s,null!=l?l.htmlMessage:l,{name:"if",hash:{},fn:n.program(1,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(s,null!=l?l.subview:l,{name:"if",hash:{},fn:n.program(3,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(s,null!=l?l.flexLayout:l,{name:"if",hash:{},fn:n.program(5,e,0),inverse:n.noop,data:e}))?i:"")+" "+n.escapeExpression("function"==typeof(r=null!=(r=t.classList||(null!=l?l.classList:l))?r:t.helperMissing)?r.call(s,{name:"classList",hash:{},data:e}):r)+'">\n\t'+(null!=(i=t.if.call(s,null!=l?l.showCancelX:l,{name:"if",hash:{},fn:n.program(7,e,0),inverse:n.noop,data:e}))?i:"")+"\n"+(null!=(i=t.if.call(s,null!=l?l.showHeader:l,{name:"if",hash:{},fn:n.program(9,e,0),inverse:n.noop,data:e}))?i:"")+'\t<div class="body'+(null!=(i=t.if.call(s,null!=l?l.showBodyLines:l,{name:"if",hash:{},fn:n.program(17,e,0),inverse:n.noop,data:e}))?i:"")+'">\n'+(null!=(i=t.if.call(s,null!=l?l.textMessage:l,{name:"if",hash:{},fn:n.program(19,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(s,null!=l?l.htmlMessage:l,{name:"if",hash:{},fn:n.program(27,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(s,null!=l?l.subview:l,{name:"if",hash:{},fn:n.program(29,e,0),inverse:n.noop,data:e}))?i:"")+"\t</div>\n"+(null!=(i=t.if.call(s,null!=l?l.showFooter:l,{name:"if",hash:{},fn:n.program(31,e,0),inverse:n.noop,data:e}))?i:"")+"</div>\n"},useData:!0}),a={};n.Array.each([],function(l){var t=n.Template.get("hermes/"+l);t&&(a[l]=t)}),n.Template.register("hermes/fluid-modal",function(l,e){return e=e||{},e.partials=e.partials?n.merge(a,e.partials):a,t(l,e)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("fluid-modal-view",function(e,t){"use strict";var i,n,a=require("hermes-core/flog")(t);i={css:{destinationContainer:"body",closeX:".close-x",buttonCancel:"button.cancel",buttonAction:"button.action",navBarContent:".head .nav",subviewContent:".content.subview",modalContent:".body .content"},options:{}},n={supportsTransform:!1,modal:{height:0,width:0}},e.namespace("Views").FluidModal=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.set("isActiveViewAgnostic",!0);var i=this.get("modalOverlayType");return this.alreadyShowingModal=i.alreadyShowingModal(),this.alreadyShowingModal||(i.add(this),e.OverlayManager.ModalOverlay.setOverlayStyle({overlayClassList:this.get("overlayClassList")})),this},activate:function(){var t=this.get("container"),n=this,a=t.one(i.css.buttonAction);return this.get("showCancelX")&&this.registerEventHandler(t.one(i.css.closeX).on(["click","keydown"],function(e){"click"!==e.type&&13!==e.keyCode||this.handleX(e)},this)),this.get("showFooter")&&this.get("showCancelButton")&&this.get("showButtons")&&this.registerEventHandler(t.one(i.css.buttonCancel).on("click",e.bind(this.handleCancel,this))),this.get("showFooter")&&this.get("showActionButton")&&this.get("showButtons")&&this.registerEventHandler(t.one(i.css.buttonAction).on("click",e.bind(this.handleAction,this))),this.registerEventHandler(this.appContext.flapp.on("activeViewChange",function(e){n.close(e)})),this.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){n.reposition()})),this.get("navBarView")&&n.get("navBarView").activate(),this.get("subview")&&(n.get("subview").normalizedActivate(),n.registerEventHandler(n.get("subview").on("actionClick",e.bind(n.handleAction,n))),n.registerEventHandler(n.get("subview").on("contentSizeChanged",e.bind(n.reposition,n))),n.registerEventHandler(n.get("subview").on("readyToClose",e.bind(n.close,n)))),this.get("focusOnFirstTabPress")&&this.registerEventHandler(t.ancestor("body").once("key",this.focusOnFirstTab.bind(this),"down:9")),e.Accessibility.manageFocusOutlines(this),this.registerEventHandler(e.on("modal:updateText",function(e){n.set("title",e.title),n.set("cancelButtonLabel",e.cancelText),n.set("actionButtonLabel",e.actionText),t.one(".title").set("textContent",e.title),t.one(".cancel").set("textContent",e.cancelText),t.one(".action").set("textContent",e.actionText)})),a&&(this.actionButtonText=a.get("text")),this.fire("activated"),this},focusOnFirstTab:function(e){var t=this.get("container").one("[tabindex]");t&&t.focus()},clearOutline:function(){var t=e.one(document.activeElement);t&&t.addClass("no-outline")},restoreOutline:function(){var e=this.get("container").one(":focus");e&&e.removeClass("no-outline")},show:function(){return this.initialize().then(null,function(e){a.error("Error initializing modal",{err:e})}),this.isClosed=!1,this.freeze(),e.fire("flickr:setKeyEventScope",this.getKeyEventScope()),this},freeze:function(){e.one("body").setStyles({overflow:"hidden"})},unfreeze:function(){e.one("body").setStyles({overflow:"visible"})},enableActionButton:function(){var e=this.get("container").one("button.action");e&&e.getAttribute("disabled")&&(e.removeAttribute("disabled"),e.set("text",this.actionButtonText))},disableActionButton:function(e){var t=this.get("container").one("button.action");t&&(t.setAttribute("disabled",!0),e&&t.set("innerHTML",this.templates("flickr-balls")({})))},showFlavorText:function(){var e=this.get("container").one(".buttons .flavor-text");e&&e.removeClass("hidden")},hideFlavorText:function(){var e=this.get("container").one(".buttons .flavor-text");e&&e.addClass("hidden")},setFlavorText:function(e,t){var i=this.get("container").one(".buttons .flavor-text");i&&(i.set("innerHTML",e),i.toggleClass("error",!!t))},buildContainer:function(){if(!this.alreadyShowingModal){var t,o=this,s=e.one(i.css.destinationContainer);t={showCancelX:this.get("showCancelX"),title:this.get("title"),htmlTitle:this.get("htmlTitle"),navBarView:!!this.get("navBarView"),noScroll:this.get("noScroll"),textMessage:this.get("textMessage"),htmlMessage:this.get("message")?this.get("message"):this.get("htmlMessage"),subview:!!this.get("subview"),showBodyLines:this.get("showBodyLines"),hideModalOverlay:this.get("hideModalOverlay"),darkOverlay:this.get("darkOverlay"),lightOverlay:this.get("lightOverlay"),showHeader:this.get("showHeader"),showFooter:this.get("showFooter"),buttons:{visible:this.get("showButtons"),action:{visible:this.get("showActionButton"),label:this.get("actionButtonLabel"),disabled:this.get("actionButtonDisabled"),isDangerous:this.get("actionButtonIsDangerous")},cancel:{visible:this.get("showCancelButton"),label:this.get("cancelButtonLabel")}},classList:this.get("classList"),contentPadding:this.get("contentPadding"),flexLayout:this.get("flexLayout")},this.get("buttonFlavorText")&&(t.buttons.flavorText={visible:this.get("showButtonFlavorText"),text:this.get("buttonFlavorText")}),this.setContainerWithTemplate("fluid-modal",t),n.modal.width=this.get("width"),n.modal.minWidth=this.get("minWidth"),n.modal.height=this.get("height"),this.get("navBarView")&&(this.get("navBarView").appContext=o.appContext,this.get("navBarView").initialize().then(function(e){e.on("subviewViewEvent",function(e){e&&e.details&&e.details.length&&(o.get("subview")&&"navigation"===e.details[0]?o.get("subview").fire.apply(o.get("subview"),["parentViewEvent"].concat(e.details)):o.get("subview")&&"search"===e.details[0]&&o.get("subview").fire.apply(o.get("subview"),["parentViewEvent"].concat(e.details)),o.fire.apply(o,e.details))}),o.get("container").one(i.css.navBarContent).appendChild(e.get("container")),o.get("subview")||o.activate()})),this.get("subview")?(this.get("subview").appContext=o.appContext,this.get("subview").set("isActiveViewAgnostic",!0),this.get("subview").initialize().then(function(e){o.on("parentViewEvent",function(t){t&&t.details&&t.details.length&&e.fire.apply(e,["parentViewEvent"].concat(t.details))}),e.on("subviewViewEvent",function(e){e&&e.details&&e.details.length&&(o.get("navBarView")&&"backToList"===e.details[0]&&o.get("navBarView").fire.apply(o.get("navBarView"),["parentViewEvent"].concat(e.details)),o.fire.apply(o,e.details))}),o.get("container").one(i.css.subviewContent).appendChild(e.get("container")),s&&(s.append(o.get("container")),o.reposition()),o.activate()},function(e){a.error("Error initializing modal subview",{err:e})})):s&&(s.append(this.get("container")),this.reposition())}return this},reposition:function(){var t,a,o,s=this.get("container").one(this.get("modalSelector")),l=e.one(e.config.win),r=parseInt(l.get("innerWidth"),10),h=parseInt(l.get("innerHeight"),10),c=n.modal.width?parseInt(n.modal.width,10):parseInt(s.getComputedStyle("width"),10),u={},d=s.one(".body"),g=0,v=this.get("showFooter")?parseInt(s.one(".foot").getComputedStyle("height"),10):0,w=0,b=parseInt(d.getComputedStyle("borderTopWidth"),10)+parseInt(d.getComputedStyle("borderBottomWidth"),10),m={};n.modal.height&&(g=s.one(".head")?parseInt(s.one(".head").getComputedStyle("height"),10):0,w=n.modal.height,s.get("showFooter")&&(v=parseInt(s.one(".foot").getComputedStyle("height"),10)),n.modal.height+g+v+80+b>=h&&(w=h<=700?h-g-v-b:h-g-v-80-b),s.setStyles({maxHeight:"none"}),this.get("flexLayout")&&s.setStyle("height",n.modal.height),this.get("fullWindow")?m.height=this.get("flexLayout")?"auto":w+"px":this.get("maxHeight")&&(m.maxHeight=this.get("flexLayout")?"auto":w+"px"),s.one(i.css.modalContent).setStyles(m)),t=parseInt(s.getComputedStyle("height"),10),a=s.getDOMNode().scrollHeight,o=s.getDOMNode().scrollWidth,u={top:"50%",left:"50%",width:n.modal.width?c+"px":"",marginTop:-t/2+"px",marginLeft:-c/2+"px",minWidth:n.modal.minWidth?n.modal.minWidth+"px":""},t+40>=h||a>=t+1||c+40>=r||o>=c?(h<=700&&n.modal.height?u.maxHeight=h-10+"px":(u.maxHeight=h-40+"px",u.overflow="auto"),u.maxWidth=r-40+"px",u.marginTop=-Math.min(parseInt(u.maxHeight,10),t)/2+"px",u.marginLeft=-Math.min(parseInt(u.maxWidth,10),c)/2+"px"):(u.maxHeight="inherit",u.maxWidth="inherit",u.overflow="visible"),s.setStyles(u)},handleX:function(i){var n=this.get("subview");e.rapidTracker.beacon(t,"modalCancelClick"),n&&n.handleX&&n.handleX(),this.close(i),this.fire("cancelClick",i)},handleCancel:function(i){var n=this.get("subview");e.rapidTracker.beacon(t,"modalCancelClick"),n&&n.handleCancel&&!1===n.handleCancel()||(this.fire("cancelClick",i),this.close(i))},handleAction:function(e){var t=this.get("subview");t&&t.handleAction&&!1===t.handleAction()||(this.fire("actionClick",e),this.get("dismissOnActionClick")&&this.close(e))},close:function(t){e.fire("flickr:removeKeyEventScope",this.getKeyEventScope());var i=this.get("container");this.isClosed=!0,e.one("body").removeClass("scroll-fluid-modal"),this.get("subview")&&this.get("subview").destroy(),this.get("navBarView")&&this.get("navBarView").destroy(),i&&i.remove(!0),this.fire("close",t),this.destroy(),this.get("removeOverlayOnClose")||this.get("modalOverlayType").remove(this)},getKeyEventScope:function(){return this.name+this._yuid},destructor:function(){this.unfreeze(),this.detachAll()}},{ATTRS:{showCancelX:{value:!0},showCancelButton:{value:!0},showBodyLines:{value:!1},showActionButton:{value:!0},hideModalOverlay:{value:!1},darkOverlay:{value:!1},lightOverlay:{value:!1},actionButtonLabel:{valueFn:function(){return this.intlMessage({intlName:"common.OK"})}},actionButtonIsDangerous:{value:!1},cancelButtonLabel:{valueFn:function(){return this.intlMessage({intlName:"common.CANCEL"})}},actionButtonDisabled:{value:!1},showButtons:{value:!0},dismissOnOverlayClick:{value:!1},dismissOnActionClick:{value:!0},title:{value:""},htmlTitle:{value:""},navBarView:{value:null},message:{value:null},textMessage:{value:null},htmlMessage:{value:null},width:{value:0},minWidth:{value:0},height:{value:0},fullWindow:{value:!1},subview:{value:null},classList:{value:""},buttonFlavorText:{value:""},showButtonFlavorText:{value:!0},showHeader:{value:!0},showFooter:{value:!0},noScroll:{value:!1},maxHeight:{value:!0},modalSelector:{value:".modal"},modalOverlayType:{value:e.OverlayManager.ModalOverlay},removeOverlayOnClose:{value:!1},overlayClassList:{value:"",validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t,i){return e.AttributeHelpers.coerceString(t)}},contentPadding:{value:void 0,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},focusOnFirstTabPress:{value:!0},flexLayout:{value:!1}}})},"@VERSION@",{requires:["flickr-view","hermes-template-fluid-modal","fluid-overlay-manager-view","attribute-helpers"],optionalRequires:["fluid"],langBundles:["common"]});YUI.add("hermes-template-explore-big-scotch-modal",function(e,a){var s=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,s,l,n){var t,r=null!=a?a:{},o=s.helperMissing,d=e.escapeExpression;return"<p>"+d((s.godMessage||a&&a.godMessage||o).call(r,{name:"godMessage",hash:{intlName:"explore.BIG_SCOTCH_REASON_MESSAGE"},data:n}))+'</p>\n<div class="dropdown-link exclude-reason-menu"><p class="tertiary">'+d("function"==typeof(t=null!=(t=s.selectedExcludeReason||(null!=a?a.selectedExcludeReason:a))?t:o)?t.call(r,{name:"selectedExcludeReason",hash:{},data:n}):t)+'</p><span class="dropdown-arrow"></span></div>\n<input type="text" id="comment-field" name="comment" placeholder="'+d((s.godMessage||a&&a.godMessage||o).call(r,{name:"godMessage",hash:{intlName:"explore.COMMENT"},data:n}))+'" />\n'},useData:!0}),l={};e.Array.each([],function(a){var s=e.Template.get("hermes/"+a);s&&(l[a]=s)}),e.Template.register("hermes/explore-big-scotch-modal",function(a,n){return n=n||{},n.partials=n.partials?e.merge(l,n.partials):l,s(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("explore-big-scotch-modal-view",function(e){var t=[];e.config.flickr&&e.config.flickr.god&&e.config.flickr.god.explore&&e.config.flickr.god.explore.scotch&&e.config.flickr.god.explore.scotch.types&&(t=e.config.flickr.god.explore.scotch.types),e.namespace("Views")[this.name]=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){var o,n;for(this.excludeReasons=[],n=0;n<t.length;n++)o=t[n],this.excludeReasons.push(e.merge(o,{text:this.godMessage({intlName:o.intlName})}));return this.set("selectedBigScotchTypeText",this.godMessage({intlName:"explore.PICK_A_REASON"})),this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("explore-big-scotch-modal",{selectedExcludeReason:this.get("selectedBigScotchTypeText")}),this},activate:function(){return this.registerEventHandler(this.get("container").one(".exclude-reason-menu").on("click",this.handleExcludeReasonMenuClick.bind(this))),this.registerEventHandler(this.get("container").one("#comment-field").on("valuechange",this.handleCommentValueChange.bind(this))),this},handleExcludeReasonMenuClick:function(t){var i=this;t.halt(),this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,anchorOffsetHorizontal:14,observePageResize:!0,anchorElement:t.target.one(".dropdown-arrow"),positionFixed:!0,preferBottom:!0,classList:"over-modal",overlayClassList:"over-modal",menuItems:this.excludeReasons}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(t){t&&t.menuItem&&t.menuItem.value!==i.get("selectedBigScotchTypeValue")&&(i.set("selectedBigScotchTypeValue",t.menuItem.value),i.set("selectedBigScotchTypeText",t.menuItem.text),i.set("needComment",!!t.menuItem.requiresComment),i.get("container").one(".exclude-reason-menu p").set("text",i.get("selectedBigScotchTypeText")),!t.menuItem.requiresComment||i.get("excludeComment")?e.fire("exploreBigScotch:justificationComplete"):e.fire("exploreBigScotch:justificationIncomplete")),i.dropdown.close()}))},handleCommentValueChange:function(t){var i=this.get("container").one("#comment-field").get("value");this.set("excludeComment",i),this.get("needComment")&&!i?e.fire("exploreBigScotch:justificationIncomplete"):i&&this.get("selectedBigScotchTypeValue")&&e.fire("exploreBigScotch:justificationComplete")}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-explore-big-scotch-modal"],langBundles:[]});YUI.add("hermes-template-fluid-subnav",function(n,e){var t=n.Template.Handlebars.revive({1:function(n,e,t,a,l){return" with-overflow-menu hidden"},3:function(n,e,t,a,l){var s;return null!=(s=t.unless.call(null!=e?e:{},null!=e?e.disabled:e,{name:"unless",hash:{},fn:n.program(4,l,0),inverse:n.noop,data:l}))?s:""},4:function(n,e,t,a,l){var s,i,r=null!=e?e:{},o=t.helperMissing,u=n.escapeExpression;return'\t\t\t\t\t<li id="'+u("function"==typeof(i=null!=(i=t.id||(null!=e?e.id:e))?i:o)?i.call(r,{name:"id",hash:{},data:l}):i)+'" class="link '+(null!=(s=t.if.call(r,null!=e?e.selected:e,{name:"if",hash:{},fn:n.program(5,l,0),inverse:n.noop,data:l}))?s:"")+'" role="menuitem">\n\t\t\t\t\t\t<a href="'+u("function"==typeof(i=null!=(i=t.href||(null!=e?e.href:e))?i:o)?i.call(r,{name:"href",hash:{},data:l}):i)+'">\n\t\t\t\t\t\t\t<span>'+u("function"==typeof(i=null!=(i=t.name||(null!=e?e.name:e))?i:o)?i.call(r,{name:"name",hash:{},data:l}):i)+"</span>\n\t\t\t\t\t\t\t"+(null!=(s=t.if.call(r,null!=e?e.label:e,{name:"if",hash:{},fn:n.program(7,l,0),inverse:n.noop,data:l}))?s:"")+"\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n"},5:function(n,e,t,a,l){return"selected"},7:function(n,e,t,a,l){var s;return'<span class="label-beta">'+n.escapeExpression("function"==typeof(s=null!=(s=t.label||(null!=e?e.label:e))?s:t.helperMissing)?s.call(null!=e?e:{},{name:"label",hash:{},data:l}):s)+"</span>"},9:function(n,e,t,a,l){return'\t\t\t\t<li class="link more-link">\n\t\t\t\t\t'+n.escapeExpression((t.intlMessage||e&&e.intlMessage||t.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{intlName:"filter-bar.MORE"},data:l}))+"\n\t\t\t\t\t<span></span>\n\t\t\t\t</li>\n"},11:function(n,e,t,a,l){return'\t\t\t\t\t<li class="overflow-menu-button">\n\t\t\t\t\t\t<svg class="icon icon-more_horizontal"><use xlink:href="#icon-more_horizontal"></use></svg>\n\t\t\t\t\t</li>\n'},13:function(n,e,t,a,l){return'\t\t\t<div class="more-link">\n\t\t\t\t'+n.escapeExpression((t.intlMessage||e&&e.intlMessage||t.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{intlName:"filter-bar.MORE"},data:l}))+'\n\t\t\t\t<a class="dropdown-arrow" role="menuitem" tabindex="0" aria-haspopup="true" aria-expanded="false"><span></span></a>\n\t\t\t</div>\n'},15:function(n,e,t,a,l){return" with-mobile-overflow-menu"},compiler:[7,">= 4.0.0"],main:function(n,e,t,a,l){var s,i=null!=e?e:{},r=t.helperMissing;return'<div class="fluid-subnav-shim">\n<div class="fluid-subnav'+(null!=(s=(t.ifCond||e&&e.ifCond||r).call(i,null!=e?e.showAutoOverflowMenu:e,"||",null!=e?e.showAutoOverflowMenuOnMobile:e,{name:"ifCond",hash:{},fn:n.program(1,l,0),inverse:n.noop,data:l}))?s:"")+'" role="navigation" aria-label="'+n.escapeExpression((t.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.SECONDARY"},data:l}))+'">\n\t<div class="subnav-content fluid-centered">\n\n\t\t<div class="subnav-items-container">\n\t\t\t<ul class="links" role="menubar">\n'+(null!=(s=t.each.call(i,null!=e?e.links:e,{name:"each",hash:{},fn:n.program(3,l,0),inverse:n.noop,data:l}))?s:"")+"\n"+(null!=(s=t.unless.call(i,null!=e?e.hideMoreLinks:e,{name:"unless",hash:{},fn:n.program(9,l,0),inverse:n.noop,data:l}))?s:"")+"\n"+(null!=(s=t.if.call(i,null!=e?e.showAutoOverflowMenu:e,{name:"if",hash:{},fn:n.program(11,l,0),inverse:n.noop,data:l}))?s:"")+"\t\t\t</ul>\n\n"+(null!=(s=t.unless.call(i,null!=e?e.hideMoreLinks:e,{name:"unless",hash:{},fn:n.program(13,l,0),inverse:n.noop,data:l}))?s:"")+'\t\t</div>\n\n\t\t<div class="fader'+(null!=(s=t.if.call(i,null!=e?e.showAutoOverflowMenuOnMobile:e,{name:"if",hash:{},fn:n.program(15,l,0),inverse:n.noop,data:l}))?s:"")+'"><span></span></div>\n\t</div>\n</div>\n</div>\n'},useData:!0}),a={};n.Array.each([],function(e){var t=n.Template.get("hermes/"+e);t&&(a[e]=t)}),n.Template.register("hermes/fluid-subnav",function(e,l){return l=l||{},l.partials=l.partials?n.merge(a,l.partials):a,t(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("animation-manager",function(n){n.AnimationManager=(function(){function i(){t&&(o.forEach(function(n,i){n()}),n.config.win.requestAnimationFrame(i))}function e(e){return o.push(e),t||(t=!0,n.config.win.requestAnimationFrame(i)),{detach:function(){o.splice(o.indexOf(e),1),o.length||(t=!1)}}}var a,t,o;return a||(t=!1,o=[],YUI.Env.isServer||n.config.win.requestAnimationFrame||(function(){var i,e,a=["webkit","moz"],t=0;for(e=0;e<a.length&&!n.config.win.requestAnimationFrame;++e)i=a[e],n.config.win.requestAnimationFrame=n.config.win[i+"RequestAnimationFrame"],n.config.win.cancelAnimationFrame=n.config.win[i+"CancelAnimationFrame"]||n.config.win[i+"CancelRequestAnimationFrame"];n.config.win.requestAnimationFrame&&n.config.win.cancelAnimationFrame||(n.config.win.requestAnimationFrame=function(n){var i=Date.now(),e=Math.max(t+16,i);return setTimeout(function(){n(t=e)},e-i)},n.config.win.cancelAnimationFrame=clearTimeout)})(),a={subscribe:e}),a})()},"@VERSION@",{requires:[]});YUI.add("fluid-subnav-view",function(e,t){"use strict";var i;i={css:{subnav:".fluid-subnav",subnavContent:".subnav-content",links:".subnav-content .links",tools:".subnav-content .tools",link:".link",altMoreLinks:"li.more-link",moreLinks:"div.more-link"},options:{}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.viewerNSID=this.appContext.getViewer().nsid,this.nsid=e.nsid?e.nsid:this.viewerNSID,this.isViewingSelf=e.isViewingSelf||!1,this.state={isFixed:!1},e.subnavConfig&&(e.subnavConfig.selected&&this.set("selected",e.subnavConfig.selected),e.subnavConfig.links&&this.set("links",e.subnavConfig.links),e.subnavConfig.moreLinks&&this.set("moreLinks",e.subnavConfig.moreLinks)),this},loadState:function(t){var i=this;return t=t||[],this.viewerNSID&&t.push(this.appContext.getModel("person-models",this.viewerNSID).then(function(e){i.set("viewerModel",e)})),this.skipLoadingPersonModel||t.push(this.appContext.getModel("person-models",this.nsid).then(function(e){i.get("links")||i.populateUrls(e)})),e.Promise.all(t)},buildContainer:function(){var e={links:this.get("links"),hideMoreLinks:void 0===this.get("moreLinks"),showAutoOverflowMenu:this.get("showAutoOverflowMenu")};return this.setContainerWithTemplate("fluid-subnav",e),this},activate:function(){return this.dialog,this.container=this.get("container"),this.subnavElement=this.get("container").one(i.css.subnav),this.listNode=this.container.one(i.css.links),this.set("floatThreshold",this.get("container").get("offsetTop")-50),this.get("floatOnScroll")&&(this.registerEventHandler(e.globalEvents.subscribe("window:scroll:nothrottle",this.toggleFixedSubnav.bind(this))),this.updateFloatThreshold(),this.registerEventHandler(e.on("globalNav:bannerSubviewActivated",this.updateFloatThreshold.bind(this))),this.registerEventHandler(e.on("globalNav:bannerDismissed",this.updateFloatThreshold.bind(this)))),void 0!==this.get("moreLinks")&&(this.registerEventHandler(this.container.one(i.css.moreLinks).on("click",this.toggleMoreLinks.bind(this))),this.registerEventHandler(this.container.one(i.css.altMoreLinks).on("click",this.toggleMoreLinks.bind(this))),this.registerEventHandler(this.container.one("a.dropdown-arrow").on("focus",this.showFocus.bind(this))),this.registerEventHandler(this.container.one("a.dropdown-arrow").on("blur",this.hideFocus.bind(this))),this.registerEventHandler(this.container.one("a.dropdown-arrow").on("keydown",this.toggleOrEnterSubmenu.bind(this)))),this.registerEventHandler(this.container.one("div.fluid-subnav").on("keydown",this.arrowTabNavigation.bind(this))),e.AnchorRepositioner.addOffset(t,this.container),this.scrollToSelected(),this.get("showAutoOverflowMenu")&&(this.overflowButtonNode=this.listNode.one(".overflow-menu-button"),this.overflowLinks=[],this.updateBreakpoints(),this.registerEventHandler(e.on("resize",e.betterThrottle(this.updateBreakpoints.bind(this),500,this,!0))),this.registerEventHandler(this.overflowButtonNode.on("click",this.handleOverflowButtonClick.bind(this)))),this.subnavElement.removeClass("hidden"),this},updateFloatThreshold:function(){this.set("floatThreshold",this.get("container").get("offsetTop")-50),this.toggleFixedSubnav()},arrowTabNavigation:function(e){var t=e.keyCode,i=e.target.ancestor("li"),s=i&&i.next("li");38===t?(e.preventDefault(),this.focusOnPreviousItem.call(this,e)):(40===t||9===t&&!e.shiftKey)&&s&&(e.preventDefault(),this.focusOnNextItem.call(this,e))},focusOnPreviousItem:function(e){var t=e.target.ancestor("li");if(t){var i=t.previous("li");i&&(this.container.all(".has-keyboard-focus").removeClass("has-keyboard-focus"),"none"!==i.getStyle("display")?i.one("a").focus():i.previous("li").one("a").focus())}else{var s=e.target.ancestor("div.subnav-content").one("ul > li:last-child").previous("li");"none"===s.getStyle("display")&&(s=s.previous("li")),s&&(this.closeSubmenu.call(this,e),this.container.all(".has-keyboard-focus").removeClass("has-keyboard-focus"),s.one("a").focus())}},focusOnNextItem:function(e){var t=e.target.ancestor("li"),i=t.next("li");this.container.all(".has-keyboard-focus").removeClass("has-keyboard-focus"),this.get("moreLinks")?t&&(i.hasClass("more-link")||"none"===i.getStyle("display")?(i=e.target.ancestor("ul").next("div"))&&(this.container.all(".has-keyboard-focus").removeClass("has-keyboard-focus"),i.one("a").focus()):(this.container.all(".has-keyboard-focus").removeClass("has-keyboard-focus"),i.one("a").focus())):(i=e.target.ancestor("li").next("li"))&&i.one("a")&&("none"!==i.getStyle("display")?i.one("a").focus():i.next("li").one("a").focus())},showFocus:function(e){e.target.ancestor().addClass("has-keyboard-focus")},hideFocus:function(e){e.target.ancestor().removeClass("has-keyboard-focus")},openSubmenu:function(e){this.toggleMoreLinks(e)},closeSubmenu:function(e){this.dialog&&this.dialog.close()},toggleOrEnterSubmenu:function(e){var t=e.keyCode;if(13===t||32===t)return e.preventDefault(),void("false"===e.target.getAttribute("aria-expanded")?this.openSubmenu.call(this,e):(this.closeSubmenu.call(this,e),this.container.one("div.more-link").addClass("has-keyboard-focus")));if(9===t&&!e.shiftKey&&"true"===e.target.getAttribute("aria-expanded")||40===t){e.preventDefault();var i=this.container.ancestor("body").one("div.droparound");if(i){var s=i.one("ul[role=menu]").one("li:first-child");s.addClass("has-keyboard-focus"),s.one("a").focus()}}else 9===t&&e.shiftKey&&this.closeSubmenu.call(this,e)},scrollToSelected:function(){var t=this.get("container").one(i.css.links),s=this.get("container").one(i.css.link+".selected"),o=Date.now(),n=this;t&&(t=t.getDOMNode()),s&&(s=s.getDOMNode().offsetLeft||0),this.animate=e.AnimationManager.subscribe(function(){var e=(Date.now()-o)/400;e>1&&(e=1),t.scrollLeft=e*s,e>=1&&n.animate.detach()})},populateUrls:function(e){this.set("links",[]),this.set("moreLinks",[]),this.set("showAutoOverflowMenu",!1),this.set("showAutoOverflowMenuOnMobile",!1)},getShareView:function(){},toggleMoreLinks:function(t){t.halt(),this.dialog=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,preferBottom:!0,observePageResize:!0,anchorElement:t.target.one("span"),minVerticalSpace:250,positionFixed:!0,anchorOffsetHorizontal:18,menuItems:this.get("moreLinks")}),this.dialog.show()},toggleFixedSubnav:function(){var t=e.config.win.scrollY||e.config.win.pageYOffset;t>this.get("floatThreshold")&&!this.state.isFixed?(this.subnavElement.addClass("fixed"),this.state.isFixed=!0):t<this.get("floatThreshold")&&this.state.isFixed&&(this.subnavElement.removeClass("fixed"),this.state.isFixed=!1),this.dialog&&this.dialog.isActiveAndInDOM()&&this.dialog.anchorPositionChange()},updateBreakpoints:function(){var e,t,i=this,s=0,o=50;if(this.overflowLinks=[],this.listNode){if(t=this.listNode.getDOMNode().getBoundingClientRect().width,e=this.listNode.all(".link"),this.overflowDroparound&&this.overflowDroparound.close(),!this.get("showAutoOverflowMenuOnMobile")&&this.appContext.viewportData.getWidth()<700)return e.each(function(e){e.removeClass("hidden")}),void this.overflowButtonNode.removeClass("displayed");e.each(function(e){e.removeClass("hidden"),e.addClass("breakpoint-displayed")}),this.overflowButtonNode.removeClass("displayed"),e.each(function(n,a){s+=n.getDOMNode().getBoundingClientRect().width+10,a!==e.size()-1||i.overflowLinks.length||(o=0),s>=t-o&&(n.addClass("hidden"),i.overflowLinks.push(i.get("links").find(function(e){return e.id===n.getAttribute("id")}))),n.removeClass("breakpoint-displayed")}),this.overflowLinks.length&&this.overflowButtonNode.addClass("displayed")}},handleOverflowButtonClick:function(){var t=this.overflowLinks.map(function(e){return{text:e.name,href:e.href,isSelected:e.selected}});this.overflowDroparound=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,preferBottom:!0,observePageResize:!0,anchorElement:this.overflowButtonNode,minVerticalSpace:250,positionFixed:!0,anchorOffsetHorizontal:9,anchorOffsetVertical:11,menuItems:t,classList:"fluid-subnav-overflow-droparound"}),this.overflowDroparound.show()},destructor:function(){e.AnchorRepositioner.removeOffset(t)}},{ATTRS:{floatOnScroll:{value:!0},floatThreshold:{value:250}}})},"@VERSION@",{requires:["flickr-view","hermes-template-fluid-subnav","fluid-droparound-view","url-helper","animation-manager"],optionalRequires:["fluid"],langBundles:["filter-bar","header","common","cameraroll","profile"]});